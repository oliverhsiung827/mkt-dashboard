<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>‰∏äÊ¥ãË°åÈä∑ Â∞àÊ°àÁÆ°ÁêÜÁ≥ªÁµ± | UP YOUNG Marketing System</title>
    <meta name="description" content="‰∏äÊ¥ãÁî¢Ê•≠Ë°åÈä∑ÈÉ®Â∞àÊ°àÁÆ°ÁêÜÁ≥ªÁµ±„ÄÇÊï¥ÂêàÂÑÄË°®Êùø„ÄÅÁîòÁâπÂúñÊéíÁ®ãËàáÂç≥ÊôÇÂ∞àÊ°àÁõ£ÊéßÔºåÂçîÂä©ÂúòÈöäÈ´òÊïàÂçî‰Ωú„ÄÇ">
    <meta name="author" content="UP YOUNG Marketing Department">
    <meta name="robots" content="noindex, nofollow">
    <link rel="shortcut icon" href="/mkt-dashboard/favicon.ico">

    <meta property="og:type" content="website">
    <meta property="og:title" content="‰∏äÊ¥ãË°åÈä∑ Â∞àÊ°àÁÆ°ÁêÜÁ≥ªÁµ±">
    <meta property="og:description" content="ÁôªÂÖ•Êü•ÁúãÂ∞àÊ°àÈÄ≤Â∫¶„ÄÅÁîòÁâπÂúñËàáÂç≥ÊôÇÂæÖËæ¶‰∫ãÈ†Ö„ÄÇ">
    <meta property="og:url" content="">
    <meta property="og:image" content="https://www.upyoung.com.tw/assets/images/logo.png">

    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="‰∏äÊ¥ãË°åÈä∑">

    <script type="text/javascript">
        (function (l) {
            if (l.search[1] === '/') {
                var decoded = l.search.slice(1).split('&').map(function (s) {
                    return s.replace(/~and~/g, '&')
                }).join('?');
                window.history.replaceState(null, null,
                    l.pathname.slice(0, -1) + decoded + l.hash
                );
            }
        }(window.location))
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif']
                    },
                    colors: {
                        upyoung: {
                            blue: '#004098',
                            yellow: '#fabe00',
                            // [New] Â∞àÈñÄÁµ¶ÊñáÂ≠óÁî®ÁöÑÊ∑±ÈáëËâ≤ÔºåËß£Ê±∫Áúã‰∏çÊ∏ÖÊ•öÁöÑÂïèÈ°å
                            darkYellow: '#B45309'
                        },
                        indigo: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#004098',
                            700: '#00337a',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        // ÂÑ™ÂåñÈÄ≤Â∫¶Ê¢ùËàáÊ®ôÁ±§È°èËâ≤
                        emerald: {
                            100: '#fffbeb', // Ê∑∫ÈªÉÂ∫ï (BadgeËÉåÊôØ)
                            500: '#fabe00', // ‰∫ÆÈªÉ (ÈÄ≤Â∫¶Ê¢ù)
                            600: '#e0a800',
                            700: '#B45309', // [ÂÑ™Âåñ] Ê∑±ÈáëÊ£ïËâ≤ (BadgeÊñáÂ≠ó)ÔºåÂèñ‰ª£ÂéüÊú¨Áúã‰∏çÊ∏ÖÊ•öÁöÑÈªÉËâ≤
                        },
                        red: {
                            500: '#fabe00', // ÈÄöÁü•Á¥ÖÈªûÊîπÈªÉ
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/vue-router@4"></script>
    <link rel="stylesheet" href="/mkt-dashboard/css/style.css">
</head>

<body class="text-slate-800 h-screen w-screen overflow-hidden text-left antialiased">
    <div style="display: none;">
        <router-view></router-view>
    </div>

    <div id="app" class="h-full w-full flex flex-col" v-cloak>
        <audio id="notification-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

        <div v-if="userParams && !dataReady"
            class="fixed inset-0 z-[10000] bg-slate-50 flex flex-col items-center justify-center">
            <div class="w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mb-4"></div>
            <div class="text-slate-500 font-bold animate-pulse text-sm">Á≥ªÁµ±ËºâÂÖ•‰∏≠...</div>
        </div>

        <div v-if="!userParams" class="fixed inset-0 z-[9999] flex items-center justify-center login-bg">
            <div class="bg-white/95 backdrop-blur-sm p-10 rounded-2xl shadow-2xl w-[400px] fade-in">
                <div class="text-center mb-8">
                    <h1 class="text-2xl font-bold text-slate-800">‰∏äÊ¥ãË°åÈä∑ÈÉ® Â∞àÊ°àÁÆ°ÁêÜÁ≥ªÁµ±</h1>
                    <p class="text-slate-500 text-sm mt-2">v1.7 2026/01/08Êõ¥Êñ∞</p>
                </div>
                <div v-if="authError" class="bg-red-50 text-red-600 p-3 rounded-lg text-sm mb-6 flex items-center"><i
                        class="fas fa-exclamation-circle mr-2"></i>( T__T) ÂóöÂóöÔºåÊàë‰πüÊÉ≥ËÆìÈÄ≤ÂéªÔºå‰ΩÜÈÄôÂÄãÂ∏≥ËôüÊàñÂØÜÁ¢ºÊàë‰∏çË™çË≠ò...</div>
                <div class="space-y-5">
                    <input v-model="authForm.email" type="email" @keyup.enter="handleAuth"
                        class="w-full border rounded-lg px-3 py-2.5 outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Email">
                    <input v-model="authForm.password" type="password" @keyup.enter="handleAuth"
                        class="w-full border rounded-lg px-3 py-2.5 outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Password">
                    <div v-if="isRegisterMode" class="space-y-5 pt-2 border-t border-slate-100 fade-in">
                        <input v-model="authForm.name" class="w-full border rounded-lg px-3 py-2.5 outline-none"
                            placeholder="ÂßìÂêç">
                        <div class="grid grid-cols-2 gap-4">
                            <select v-model="authForm.team"
                                class="w-full border rounded-lg px-3 py-2.5 bg-white text-sm">
                                <option value="digital">Êï∏‰ΩçË™≤</option>
                                <option value="brand">ÂìÅÁâåË™≤</option>
                                <option value="pr">ÂÖ¨ÈóúË™≤</option>
                                <option value="design">Ë®≠Ë®àË™≤</option>
                                <option value="mkgt">Ë°åÈä∑ÈÉ®</option>
                            </select>
                            <select v-model="authForm.role"
                                class="w-full border rounded-lg px-3 py-2.5 bg-white text-sm">
                                <option value="member">ËÅ∑Âì°</option>
                                <option value="manager">Ë™≤‰∏ªÁÆ°</option>
                                <option value="director">ÈÉ®‰∏ªÁÆ°</option>
                            </select>
                        </div>
                    </div>
                    <button @click="handleAuth"
                        class="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition">{{
                        isRegisterMode ? 'Ë®ªÂÜä' : 'ÁôªÂÖ•' }}</button>
                    <div class="text-center mt-6"><button @click="toggleAuthMode"
                            class="text-xs text-indigo-600 hover:underline">{{ isRegisterMode ? 'ËøîÂõûÁôªÂÖ•' : 'Ë®ªÂÜäÊñ∞Â∏≥Ëôü'
                            }}</button></div>
                </div>
            </div>
        </div>

        <template v-else-if="dataReady">
            <header
                class="bg-white border-b border-slate-200 h-16 flex items-center px-4 md:px-6 justify-between flex-shrink-0 z-20 relative shadow-sm">
                <div class="font-bold text-xl flex items-center tracking-tight text-slate-800">
                    <button @click="showMobileSidebar = !showMobileSidebar"
                        class="mr-4 text-slate-500 hover:text-indigo-600 md:hidden">
                        <i class="fas fa-bars text-xl"></i>
                    </button>

                    <img src="logo.png" alt="‰∏äÊ¥ã Logo" class="h-8 w-auto mr-3 object-contain" />

                    <span class="hidden md:inline">‰∏äÊ¥ãË°åÈä∑ÈÉ®</span>
                    <span class="md:hidden">‰∏äÊ¥ãË°åÈä∑</span>
                    <span class="font-normal text-slate-400 mx-2">/</span>
                    <span class="text-sm md:text-xl">Â∞àÊ°àÁÆ°ÁêÜÁ≥ªÁµ±</span>
                </div>
                <div class="flex items-center gap-4">
                    <div class="relative">
                        <div @click="showNotifications = !showNotifications"
                            class="w-9 h-9 rounded-full bg-slate-50 hover:bg-slate-100 text-slate-500 flex items-center justify-center cursor-pointer transition relative">
                            <i class="fas fa-bell"></i>
                            <span v-if="unreadNotificationsCount > 0"
                                class="absolute top-0 right-0 w-3 h-3 bg-red-500 border-2 border-white rounded-full"></span>
                        </div>
                        <div v-if="showNotifications"
                            class="absolute right-0 top-12 w-80 bg-white rounded-xl shadow-2xl border border-slate-100 overflow-hidden z-50 fade-in">
                            <div
                                class="px-4 py-3 border-b text-xs font-bold text-slate-500 bg-slate-50 flex justify-between items-center">
                                <span>ÈÄöÁü•‰∏≠ÂøÉ</span><button v-if="notifications.length > 0" @click="clearAllNotifications"
                                    class="text-indigo-600 hover:underline">ÂÖ®ÈÉ®Ê∏ÖÈô§</button>
                            </div>
                            <div class="max-h-80 overflow-y-auto">
                                <div v-if="notifications.length === 0"
                                    class="p-8 text-center text-slate-400 text-xs italic">ÁÑ°Êñ∞ÈÄöÁü•</div>
                                <div v-for="n in notifications" :key="n.id" @click="handleNotificationClick(n)"
                                    :class="['p-3 border-b hover:bg-indigo-50 cursor-pointer transition flex items-start gap-3', n.read ? 'opacity-50' : 'bg-white']">
                                    <div
                                        class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center flex-shrink-0 text-xs">
                                        <i class="fas"
                                            :class="n.type === 'handoff' ? 'fa-exchange-alt' : 'fa-tasks'"></i>
                                    </div>
                                    <div>
                                        <div class="text-xs font-bold text-slate-700 mb-0.5">{{ n.title }}</div>
                                        <div class="text-[10px] text-slate-500">{{ n.message }}</div>
                                        <div class="text-[8px] text-slate-300 mt-1">{{ n.time }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-right hidden md:block">
                        <div class="text-sm font-bold text-slate-700">{{ currentUser?.name || 'Loading...' }}</div>
                        <div class="text-[10px] text-slate-400 font-medium uppercase">{{ teamMap[currentUser?.team]}} ‚Ä¢
                            {{ roleMap[currentUser?.role] }}</div>
                    </div>
                    <div class="w-9 h-9 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center font-bold border border-indigo-100 cursor-pointer hover:bg-red-50 hover:text-red-600 transition"
                        @click="logout" title="ÁôªÂá∫">{{ (currentUser?.name || 'U').substring(0,1) }}</div>
                </div>
            </header>

            <div class="flex flex-1 w-full overflow-hidden items-stretch relative" @click="showNotifications=false">

                <!-- ÊâãÊ©üÁâàÈÅÆÁΩ©Â±§ -->
                <div v-if="showMobileSidebar" @click="showMobileSidebar = false"
                    class="fixed inset-0 bg-slate-900/80 z-30 md:hidden fade-in"></div>

                <div :class="['bg-slate-900 text-slate-300 flex flex-col shadow-inner flex-shrink-0 h-full border-r border-slate-800 transition-all duration-75 ease-linear z-40 relative group/sidebar', 
    showMobileSidebar ? 'translate-x-0 fixed w-64' : '-translate-x-full fixed md:relative md:translate-x-0',
    isSidebarCollapsed ? 'md:w-16' : '' ]"
                    :style="(!showMobileSidebar && !isSidebarCollapsed) ? { width: sidebarWidth + 'px' } : {}">

                    <div v-if="!isSidebarCollapsed && !showMobileSidebar" @mousedown.prevent="startResizeSidebar"
                        class="absolute right-[-4px] top-0 bottom-0 w-1.5 cursor-col-resize z-50 hover:bg-indigo-500 transition-colors opacity-0 hover:opacity-100 group-hover/sidebar:opacity-100 delay-100"
                        title="ÊãñÊõ≥Ë™øÊï¥ÂØ¨Â∫¶">
                    </div>


                    <div class="flex-1 overflow-y-auto no-scrollbar py-4 flex flex-col">

                        <div class="px-3 mb-4 space-y-1">
                            <button @click="navigateTo('dashboard')" :title="isSidebarCollapsed ? 'Êà∞ÊÉÖÂÑÄË°®Êùø' : ''" :class="['w-full text-left py-2.5 rounded-lg flex items-center transition relative group', 
    currentView === 'dashboard' ? 'bg-upyoung-blue text-white' : 'hover:bg-slate-800',
    isSidebarCollapsed ? 'justify-center px-0' : 'px-3']">
                                <i class="fas fa-chart-pie text-lg flex-shrink-0"
                                    :class="isSidebarCollapsed ? '' : 'w-6 opacity-70'"></i>
                                <span class="whitespace-nowrap transition-opacity duration-200"
                                    :class="isSidebarCollapsed ? 'opacity-0 w-0 hidden' : 'opacity-100 ml-2'">Êà∞ÊÉÖÂÑÄË°®Êùø</span>
                            </button>

                            <button @click="navigateTo('report')" :title="isSidebarCollapsed ? 'Ê≠∑Âè≤Á∏æÊïàÂ†±Ë°®' : ''" :class="['w-full text-left py-2.5 rounded-lg flex items-center transition relative group', 
    currentView === 'history_report' ? 'bg-upyoung-blue text-white' : 'hover:bg-slate-800',
    isSidebarCollapsed ? 'justify-center px-0' : 'px-3']">
                                <i class="fas fa-history text-lg flex-shrink-0"
                                    :class="isSidebarCollapsed ? '' : 'w-6 opacity-70'"></i>
                                <span class="whitespace-nowrap transition-opacity duration-200"
                                    :class="isSidebarCollapsed ? 'opacity-0 w-0 hidden' : 'opacity-100 ml-2'">Ê≠∑Âè≤Á∏æÊïàÂ†±Ë°®</span>
                            </button>

                            <button @click="navigateTo('workspace')" :title="isSidebarCollapsed ? 'ÊàëÁöÑÂ∑•‰ΩúÂçÄ' : ''" :class="['w-full text-left py-2.5 rounded-lg flex items-center transition relative group', 
    currentView === 'my_workspace' ? 'bg-upyoung-blue text-white' : 'hover:bg-slate-800',
    isSidebarCollapsed ? 'justify-center px-0' : 'px-3']">
                                <i class="fas fa-tasks text-lg flex-shrink-0"
                                    :class="isSidebarCollapsed ? '' : 'w-6 opacity-70'"></i>
                                <span class="whitespace-nowrap transition-opacity duration-200"
                                    :class="isSidebarCollapsed ? 'opacity-0 w-0 hidden' : 'opacity-100 ml-2'">ÊàëÁöÑÂ∑•‰ΩúÂçÄ</span>
                            </button>
                        </div>
                        <div class="px-3 mb-4 pt-4 border-t border-slate-800 mx-2">
                            <div v-show="!isSidebarCollapsed" @click="isCommonLinksExpanded = !isCommonLinksExpanded"
                                class="px-2 mb-2 text-[10px] font-bold text-slate-500 uppercase tracking-wider fade-in flex justify-between items-center cursor-pointer hover:text-slate-300 transition select-none">
                                <span>Â∏∏Áî®ÈÄ£Áµê</span>
                                <i
                                    :class="['fas text-[10px] transition-transform duration-200', isCommonLinksExpanded ? 'fa-chevron-down' : 'fa-chevron-right']"></i>
                            </div>

                            <div class="space-y-1" v-show="isSidebarCollapsed || isCommonLinksExpanded">
                                <a v-for="link in commonLinks" :key="link.title" :href="link.url" target="_blank"
                                    :title="isSidebarCollapsed ? link.title : ''" :class="['w-full text-left py-2 rounded-lg flex items-center transition relative group hover:bg-slate-800 text-slate-400 hover:text-white', 
                       isSidebarCollapsed ? 'justify-center px-0' : 'px-3']">
                                    <i
                                        :class="[link.icon, 'text-lg flex-shrink-0', isSidebarCollapsed ? '' : 'w-6 text-center opacity-70']"></i>

                                    <span class="whitespace-nowrap transition-opacity duration-200 text-sm ml-2"
                                        :class="isSidebarCollapsed ? 'opacity-0 w-0 hidden' : 'opacity-100'">
                                        {{ link.title }}
                                    </span>

                                    <i v-show="!isSidebarCollapsed"
                                        class="fas fa-external-link-alt text-[10px] absolute right-2 opacity-0 group-hover:opacity-50"></i>
                                </a>
                            </div>
                        </div>


                        <div class="px-3 mb-2" v-show="!isSidebarCollapsed">
                            <div class="relative">
                                <input v-model="sidebarSearch" type="text"
                                    class="w-full bg-slate-800 border border-slate-700 rounded-lg py-1.5 pl-8 pr-3 text-xs text-slate-300 placeholder-slate-500 outline-none focus:border-upyoung-yellow"
                                    placeholder="ÊêúÂ∞ãÂ∞àÊ°à...">
                                <i class="fas fa-search absolute left-2.5 top-2 text-slate-500 text-xs"></i>
                            </div>
                        </div>

                        <div class="px-2 mt-2 flex-1 overflow-y-auto no-scrollbar" v-show="!isSidebarCollapsed">
                            <div class="flex justify-between items-center px-3 mb-2">
                                <span class="text-[10px] text-slate-500 uppercase font-bold tracking-wider">ÂìÅÁâåÂ∞àÊ°à</span>
                                <button v-if="currentUser.role === 'admin'" @click="addBrand"
                                    class="text-slate-500 hover:text-white text-xs bg-slate-800 w-5 h-5 rounded flex items-center justify-center transition">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <div v-for="brand in visibleBrands" :key="brand.id" class="mb-2">
                                <div @click="toggleBrand(brand.id)"
                                    class="px-3 py-1.5 text-xs font-bold text-slate-400 hover:text-white cursor-pointer flex items-center group transition hover:bg-slate-800 rounded">
                                    <i
                                        :class="['fas mr-2 text-[10px] w-3 transition-transform', isBrandExpanded(brand.id) ? 'fa-chevron-down' : 'fa-chevron-right']"></i>
                                    <span class="flex-1 truncate">{{ brand.name }}</span>
                                    <button @click.stop="openProjectModal(brand.id)"
                                        class="opacity-0 group-hover:opacity-100 text-slate-500 hover:text-white transition px-1"
                                        title="ÈñãÁ´ãÂ∞àÊ°à">+</button>
                                </div>
                                <div v-show="isBrandExpanded(brand.id)" class="mt-1">
                                    <div v-for="proj in getMatchingProjects(brand.id)" :key="proj.id" class="mb-1">
                                        <div @click="toggleExpand(proj); selectParentProject(proj)"
                                            :class="['flex items-center justify-between pl-6 pr-3 py-2 cursor-pointer text-xs group transition rounded-lg relative', (currentParentProject?.id === proj.id) ? 'bg-slate-800 text-white' : 'hover:bg-slate-800/50 hover:text-white']">
                                            <div class="flex items-center truncate w-full">
                                                <i
                                                    :class="['fas fa-chevron-right text-[10px] w-4 transition mr-1', proj.expanded ? 'rotate-90' : '']"></i>
                                                <span class="truncate">{{ proj.title }}</span>
                                            </div>
                                        </div>
                                        <div v-if="proj.expanded"
                                            class="ml-4 border-l border-slate-700 pl-2 space-y-0.5 mt-1 mb-2 fade-in">
                                            <div v-for="sp in (getSubsForParent(proj.id))" :key="sp.id"
                                                @click.stop="selectSubProject(sp, proj)"
                                                :class="['text-xs cursor-pointer px-3 py-1.5 rounded-md truncate transition hover:bg-slate-800', (currentView === 'sub_project_detail' && currentSubProject?.id === sp.id) ? 'text-upyoung-yellow bg-slate-800 font-medium' : 'text-slate-500 hover:text-slate-200']">
                                                <span class="truncate">{{ sp.title }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div v-show="isSidebarCollapsed" class="flex-1 flex flex-col items-center pt-4 opacity-50">
                            <i class="fas fa-ellipsis-h text-slate-600"></i>
                        </div>
                    </div>

                    <div class="border-t border-slate-800 bg-slate-900/50 flex flex-col">
                        <button @click="isSidebarCollapsed = !isSidebarCollapsed"
                            class="w-full py-3 text-slate-500 hover:text-white hover:bg-slate-800 transition flex items-center justify-center"
                            :title="isSidebarCollapsed ? 'Â±ïÈñãÂÅ¥ÈÇäÊ¨Ñ' : 'Êî∂Ëµ∑ÂÅ¥ÈÇäÊ¨Ñ'">
                            <i class="fas" :class="isSidebarCollapsed ? 'fa-chevron-right' : 'fa-chevron-left'"></i>
                        </button>

                        <div class="p-2 border-t border-slate-800" v-show="!isSidebarCollapsed">
                            <div @click="showArchived = !showArchived"
                                class="px-3 py-2 text-xs font-bold text-slate-500 hover:text-slate-300 cursor-pointer flex rounded-lg hover:bg-slate-800 transition justify-between">
                                <span><i class="fas fa-archive mr-2"></i> Â∑≤Ê≠∏Ê™î</span>
                                <i :class="['fas transition', showArchived ? 'rotate-180' : '']"></i>
                            </div>
                            <div v-if="showArchived"
                                class="mt-2 bg-slate-800 rounded-lg p-2 border border-slate-700 fade-in">

                                <div class="mb-2 relative">
                                    <input v-model="archiveSearch" type="text"
                                        class="w-full bg-slate-900 border border-slate-600 rounded px-2 py-1 text-[10px] text-slate-300 placeholder-slate-600 focus:border-slate-400 outline-none"
                                        placeholder="ÊêúÂ∞ãÊ≠∏Ê™î...">
                                    <i v-if="archiveSearch" @click="archiveSearch=''"
                                        class="fas fa-times absolute right-2 top-1.5 text-[10px] text-slate-500 cursor-pointer hover:text-white"></i>
                                </div>

                                <div class="space-y-1 max-h-32 overflow-y-auto custom-scrollbar">
                                    <div v-if="archivedProjects.length === 0"
                                        class="text-[10px] text-slate-500 text-center py-2">
                                        ÁÑ°Á¨¶ÂêàÂ∞àÊ°à
                                    </div>

                                    <div v-for="proj in archivedProjects" :key="proj.id"
                                        @click="selectParentProject(proj)"
                                        class="text-xs text-slate-400 hover:text-white cursor-pointer px-2 py-1 rounded hover:bg-slate-700 truncate transition flex items-center justify-between group">

                                        <div class="flex items-center truncate">
                                            <i class="fas mr-2 text-[10px] opacity-50"
                                                :class="proj.status === 'aborted' ? 'fa-ban text-red-400' : 'fa-box-archive'"></i>
                                            <span class="truncate"
                                                :class="proj.status === 'aborted' ? 'line-through decoration-slate-600' : ''">
                                                {{ proj.title }}
                                            </span>
                                        </div>
                                        <span v-if="proj.status === 'aborted'"
                                            class="text-[9px] bg-red-900/50 text-red-300 px-1 rounded ml-1 opacity-0 group-hover:opacity-100">‰∏≠Ê≠¢</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button v-show="isSidebarCollapsed" @click="isSidebarCollapsed = false; showArchived = true"
                            class="py-3 text-slate-500 hover:text-white hover:bg-slate-800 transition flex justify-center"
                            title="Êü•ÁúãÊ≠∏Ê™î">
                            <i class="fas fa-archive"></i>
                        </button>
                    </div>
                </div>

                <div class="flex-1 flex flex-col bg-slate-50 overflow-hidden relative items-start w-full" @click.stop>

                    <div v-if="currentView === 'dashboard'" class="flex-1 overflow-y-auto p-8 w-full fade-in">
                        <div
                            class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 w-full gap-4">
                            <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-3">Ë°åÈä∑ÈÉ® Â∞àÊ°àÁ∏ΩË¶Ω<span
                                    class="text-sm font-normal text-slate-400 bg-white border px-2 py-1 rounded-full">Current
                                    Active</span></h2>
                            <div class="flex flex-wrap gap-2">
                                <select v-model="selectedDashboardBrand"
                                    class="border border-slate-300 rounded-lg px-3 py-1.5 text-sm bg-white font-bold text-slate-600 outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="all">ÊâÄÊúâÂìÅÁâå</option>
                                    <option v-for="b in sortedBrands" :value="b.id">{{ b.name }}</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 w-full">
                            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="text-xs font-bold text-slate-500 uppercase">Âü∑Ë°å‰∏≠Ê°à‰ª∂</div>
                                    <div
                                        class="w-8 h-8 rounded-full bg-blue-100 text-blue-500 flex items-center justify-center">
                                        <i class="fas fa-running"></i>
                                    </div>
                                </div>
                                <div class="text-3xl font-bold text-slate-800">{{ scopedStats.active?.count || 0 }}
                                </div>
                            </div>
                            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="text-xs font-bold text-slate-500 uppercase">Áï∂ÂâçÂª∂ÈÅ≤Áéá</div>
                                    <div
                                        class="w-8 h-8 rounded-full bg-orange-100 text-orange-500 flex items-center justify-center">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                </div>
                                <div class="text-3xl font-bold text-orange-600">{{ scopedStats.active?.delayRate || 0
                                    }}<span class="text-sm">%</span></div>
                            </div>
                            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="text-xs font-bold text-slate-500 uppercase">Áï∂ÂâçÂª∂ÈÅ≤Â§©Êï∏</div>
                                    <div
                                        class="w-8 h-8 rounded-full bg-red-100 text-red-500 flex items-center justify-center">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                </div>
                                <div class="text-3xl font-bold text-red-600">{{ scopedStats.active?.totalDelayDays || 0
                                    }} <span class="text-sm font-normal text-slate-400">Â§©</span></div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-8">
                            <div
                                class="px-6 py-4 border-b border-slate-100 bg-red-50/50 flex justify-between items-center">
                                <h3 class="font-bold text-red-800"><i class="fas fa-bolt mr-2"></i> Âü∑Ë°å‰∏≠Â∞àÊ°àÂª∂ÈÅ≤ÂéüÂõ†</h3>
                            </div>
                            <div class="p-6">
                                <div v-if="!scopedStats?.active?.reasonList || scopedStats.active.reasonList.length===0"
                                    class="text-center text-slate-400 text-sm">Â∞öÁÑ°Ë≥áÊñô</div>
                                <div class="space-y-4" v-else>
                                    <div v-for="r in scopedStats.active.reasonList" :key="r.name"
                                        class="flex items-center">
                                        <div class="w-24 text-xs font-bold text-slate-600 text-right mr-4">{{ r.name }}
                                        </div>
                                        <div class="flex-1 bg-slate-100 rounded-full h-3 relative">
                                            <div class="bg-red-500 h-3 rounded-full" :style="{width: r.percent + '%'}">
                                            </div>
                                        </div>
                                        <div class="w-16 text-xs font-bold text-red-600 ml-4 text-right">{{ r.count }}
                                            ({{ r.percent }}%)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm border border-slate-200 mb-8 w-full overflow-hidden">
                            <div
                                class="px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                                <h3 class="font-bold text-slate-700"><i
                                        class="fas fa-satellite-dish mr-2 text-indigo-500"></i> Âü∑Ë°åÁõ£Êéß </h3><button
                                    v-if="filterStatus!=='all'" @click="filterStatus='all'"
                                    class="text-xs text-indigo-600 hover:underline">È°ØÁ§∫ÂÖ®ÈÉ®</button>
                            </div>
                            <div class="overflow-x-auto w-full">
                                <table class="w-full text-sm text-left">
                                    <thead class="text-xs text-slate-500 uppercase bg-slate-50 border-b">
                                        <tr>
                                            <th class="px-6 py-3">ÂìÅÁâå / Â∞àÊ°à / ÂàÜÊîØ</th>
                                            <th class="px-6 py-3">Ë≤†Ë≤¨‰∫∫</th>
                                            <th class="px-6 py-3">ÁõÆÂâçËôïÁêÜ / ÊªØÁïô</th>
                                            <th class="px-6 py-3 text-center">Êà™Ê≠¢Êó•</th>
                                            <th class="px-6 py-3 text-center">ÂØ¶ÈöõÂ∑•ÊôÇ</th>
                                            <th class="px-6 py-3">ÁãÄÊÖã</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-100">
                                        <tr v-if="filteredMonitorList.length===0">
                                            <td colspan="6" class="px-6 py-4 text-center text-slate-400">Â∞öÁÑ°Ë≥áÊñô</td>
                                        </tr>
                                        <tr v-for="item in filteredMonitorList" :key="item.branch.id"
                                            class="hover:bg-slate-50 transition cursor-pointer"
                                            @click="openQuickView(item.branch, item.parent, item.brand)">
                                            <td class="px-6 py-3">
                                                <div class="text-xs text-slate-400 flex items-center gap-1 mb-1"><span
                                                        class="bg-indigo-50 text-indigo-600 px-1.5 py-0.5 rounded font-bold">{{
                                                        item?.brand?.name || 'Unknown' }}</span><i
                                                        class="fas fa-chevron-right text-[8px]"></i><span>{{
                                                        item?.parent?.title || 'Unknown' }}</span></div>
                                                <div class="font-bold text-slate-800 pl-1">{{ item.branch.title }}</div>
                                            </td>
                                            <td class="px-6 py-3 flex items-center">
                                                <div
                                                    class="w-6 h-6 rounded bg-slate-200 text-slate-600 text-xs flex justify-center items-center mr-2">
                                                    {{ (item.branch.assignee || 'U').substring(0,1) }}</div>{{
                                                item.branch.assignee }}
                                            </td>
                                            <td class="px-6 py-3">
                                                <div class="flex flex-col"><span
                                                        class="font-bold text-indigo-700 text-xs">{{
                                                        item.branch.currentHandler || item.branch.assignee
                                                        }}</span><span class="text-[10px] text-slate-400 mt-0.5">ÊªØÁïô {{
                                                        getDaysHeld(item.branch) }} Â§©</span></div>
                                            </td>
                                            <td class="px-6 py-3 text-center font-mono"
                                                :class="getDateStyle(item.branch.endDate, item.branch.status)">
                                                {{ item.branch.endDate||'--' }}
                                            </td>
                                            <td class="px-6 py-3 text-center font-bold text-blue-600">{{
                                                calcSubProjectHours(item.branch) }} h</td>
                                            <td class="px-6 py-3"><span
                                                    v-if="getProjectHealth(item.branch).type === 'delay'"
                                                    class="bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-bold">üî¥
                                                    Âª∂ÈÅ≤ {{ getProjectHealth(item.branch).days }} Â§©</span><span
                                                    v-else-if="getProjectHealth(item.branch).type === 'lag'"
                                                    class="bg-orange-100 text-orange-700 px-2 py-1 rounded text-xs font-bold">üü†
                                                    ËêΩÂæå {{ getProjectHealth(item.branch).days }} Â§©</span><span v-else
                                                    class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded text-xs font-bold">üü¢
                                                    Ê≠£Â∏∏</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm border border-slate-200 w-full overflow-hidden">
                            <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
                                <h3 class="font-bold text-slate-700"><i
                                        class="fas fa-users-cog mr-2 text-indigo-500"></i> ‰∫∫Âì°Áî¢ËÉΩ (Áï∂ÂâçÁãÄÊÖã)</h3>
                            </div>
                            <div class="overflow-x-auto w-full">
                                <table class="w-full text-sm text-left">
                                    <thead class="text-xs text-slate-500 uppercase bg-slate-50 border-b">
                                        <tr>
                                            <th class="px-6 py-3">ÊàêÂì°</th>
                                            <th class="px-6 py-3 text-center">Âü∑Ë°å‰∏≠Ê°à‰ª∂</th>
                                            <th class="px-6 py-3 text-right">Áï∞Â∏∏</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-100">
                                        <tr v-for="m in memberStats" :key="m.id"
                                            class="hover:bg-indigo-50 cursor-pointer transition relative z-10"
                                            @click="openMemberDetail(m)">
                                            <td class="px-6 py-3 font-bold text-slate-700">
                                                <span
                                                    class="text-[10px] bg-slate-100 border border-slate-200 text-slate-500 px-1.5 py-0.5 rounded mr-2 uppercase">{{
                                                    teamMap[m.team] || 'N/A' }}</span>{{ m.name }}
                                            </td>
                                            <td class="px-6 py-3 text-center">
                                                <span
                                                    :class="['px-2 py-1 rounded text-xs font-bold', m.activeBranches>3?'bg-orange-100 text-orange-700':'bg-slate-100']">{{
                                                    m.activeBranches }}</span>
                                            </td>
                                            <td class="px-6 py-3 text-right">
                                                <span v-if="m.delayCount>0" class="text-red-500 text-xs font-bold">{{
                                                    m.delayCount }} Âª∂Ë™§</span>
                                                <span v-else class="text-emerald-500 text-xs font-bold">Ê≠£Â∏∏</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div v-if="currentView === 'history_report'" class="flex-1 overflow-y-auto p-8 w-full fade-in">
                        <div
                            class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 w-full gap-4">
                            <h2 class="text-2xl font-bold text-slate-800 flex items-center gap-3">
                                <i class="fas fa-history text-indigo-500"></i> Ê≠∑Âè≤Á∏æÊïàÂ†±Ë°®<span
                                    class="text-sm font-normal text-slate-400 bg-white border px-2 py-1 rounded-full">{{
                                    currentYear }} / {{ currentMonth === 'all' ? 'All' : currentMonth }}</span>
                            </h2>
                            <div class="flex flex-wrap gap-2 items-center"><button @click="exportHistoryReport"
                                    class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-1.5 rounded-lg text-xs font-bold transition mr-2 flex items-center"><i
                                        class="fas fa-file-export mr-2"></i> ÂåØÂá∫Â†±Ë°®</button><select
                                    v-model="selectedDashboardBrand"
                                    class="border border-slate-300 rounded-lg px-3 py-1.5 text-sm bg-white font-bold text-slate-600 outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="all">ÊâÄÊúâÂìÅÁâå</option>
                                    <option v-for="b in sortedBrands" :value="b.id">{{ b.name }}</option>
                                </select><select v-model="currentYear"
                                    class="border border-slate-300 rounded-lg px-3 py-1.5 text-sm bg-white font-bold text-slate-600 outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option v-for="y in availableYears" :value="y">{{ y }}Âπ¥</option>
                                </select><select v-model="currentMonth"
                                    class="border border-slate-300 rounded-lg px-3 py-1.5 text-sm bg-white font-bold text-slate-600 outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="all">ÂÖ®Âπ¥</option>
                                    <option v-for="m in 12" :value="m">{{ m }}Êúà</option>
                                </select></div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8 w-full">
                            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="text-xs font-bold text-slate-500 uppercase">Á∏ΩÁµêÊ°àÈáè</div>
                                    <div
                                        class="w-8 h-8 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center">
                                        <i class="fas fa-folder"></i>
                                    </div>
                                </div>
                                <div class="text-3xl font-bold text-slate-800">{{ scopedStats.overall?.totalProjects ||
                                    0 }}
                                </div>
                            </div>
                            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="text-xs font-bold text-slate-500 uppercase">Á∏ΩÈ´îÂª∂ÈÅ≤Áéá</div>
                                    <div
                                        class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-500 flex items-center justify-center">
                                        <i class="fas fa-percentage"></i>
                                    </div>
                                </div>
                                <div class="text-3xl font-bold text-indigo-600">{{ scopedStats.overall?.delayRate || 0
                                    }}
                                    <span class="text-sm">%</span>
                                </div>
                            </div>
                            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="text-xs font-bold text-slate-500 uppercase">Á¥ØÁ©çÂª∂ÈÅ≤Â§©Êï∏</div>
                                    <div
                                        class="w-8 h-8 rounded-full bg-pink-100 text-pink-500 flex items-center justify-center">
                                        <i class="fas fa-history"></i>
                                    </div>
                                </div>
                                <div class="text-3xl font-bold text-pink-600">{{ scopedStats.overall?.totalDelayDays ||
                                    0 }}
                                    <span class="text-sm font-normal text-slate-400">Â§©</span>
                                </div>
                            </div>
                            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="text-xs font-bold text-slate-500 uppercase">ÊúüÈñìÊ≠∏Ê™îÂ∑•ÊôÇ</div>
                                    <div
                                        class="w-8 h-8 rounded-full bg-emerald-100 text-emerald-500 flex items-center justify-center">
                                        <i class="fas fa-archive"></i>
                                    </div>
                                </div>
                                <div class="text-3xl font-bold text-slate-800">{{ scopedStats?.archivedHours || 0 }}
                                    <span class="text-sm font-medium text-slate-400">h</span>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 gap-6 mb-8 w-full">
                            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                <div
                                    class="px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                                    <h3 class="font-bold text-slate-700">
                                        <i class="fas fa-archive mr-2"></i> Ê≠∑Âè≤Âª∂ÈÅ≤Ëàá‰∏≠Ê≠¢ÂéüÂõ†ÂàÜÊûê
                                    </h3>
                                </div>
                                <div class="p-6">
                                    <div v-if="!scopedStats?.overall?.reasonList || scopedStats.overall.reasonList.length===0"
                                        class="text-center text-slate-400 text-sm">Â∞öÁÑ°Ë≥áÊñô</div>
                                    <div class="space-y-4" v-else>
                                        <div v-for="r in scopedStats.overall.reasonList" :key="r.name"
                                            class="flex items-center">
                                            <div class="w-24 text-xs font-bold text-slate-600 text-right mr-4">{{ r.name
                                                }}</div>
                                            <div class="flex-1 bg-slate-100 rounded-full h-3 relative">
                                                <div class="bg-indigo-500 h-3 rounded-full"
                                                    :style="{width: r.percent + '%'}"></div>
                                            </div>
                                            <div class="w-16 text-xs font-bold text-indigo-600 ml-4 text-right">{{
                                                r.count }} ({{ r.percent }}%)</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm border border-slate-200 mb-8 w-full overflow-hidden">
                            <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50">
                                <h3 class="font-bold text-slate-700">Ê≠∏Ê™îÂ∞àÊ°àÂàóË°®</h3>
                            </div>
                            <div class="overflow-x-auto w-full">
                                <table class="w-full text-sm text-left">
                                    <thead class="text-xs text-slate-500 uppercase bg-slate-50 border-b">
                                        <tr>
                                            <th class="px-6 py-3">ÂìÅÁâå / Â∞àÊ°à / ÂàÜÊîØ</th>
                                            <th class="px-6 py-3">Ë≤†Ë≤¨‰∫∫</th>
                                            <th class="px-6 py-3 text-center">ÁµêÊ°àÊó•</th>
                                            <th class="px-6 py-3 text-center">Á∏ΩÂ∑•ÊôÇ</th>
                                            <th class="px-6 py-3">ÊúÄÁµÇÁãÄÊÖã</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-slate-100">
                                        <tr v-if="scopedStats.archivedList.length===0">
                                            <td colspan="5" class="px-6 py-4 text-center text-slate-400">Â∞öÁÑ°Ê≠∏Ê™îË≥áÊñô</td>
                                        </tr>
                                        <tr v-for="item in scopedStats.archivedList" :key="item.branch.id"
                                            class="hover:bg-slate-50 transition cursor-pointer"
                                            @click="selectSubProject(item.branch, item.parent)">
                                            <td class="px-6 py-3">
                                                <div class="text-xs text-slate-400 flex items-center gap-1 mb-1"><span
                                                        class="bg-indigo-50 text-indigo-600 px-1.5 py-0.5 rounded font-bold">{{
                                                        item?.brand?.name || 'Unknown' }}</span><i
                                                        class="fas fa-chevron-right text-[8px]"></i><span>{{
                                                        item?.parent?.title || 'Unknown' }}</span></div>
                                                <div class="font-bold text-slate-800 pl-1">{{ item.branch.title }}</div>
                                            </td>
                                            <td class="px-6 py-3">{{ item.branch.assignee }}</td>
                                            <td class="px-6 py-3 text-center font-mono">{{ item.branch.endDate }}</td>
                                            <td class="px-6 py-3 text-center font-bold text-blue-600">{{
                                                item.branch.actHours }} h</td>
                                            <td class="px-6 py-3">
                                                <span
                                                    :class="['px-2 py-1 rounded text-xs font-bold', item.branch.status==='aborted'?'bg-slate-200 text-slate-600':'bg-emerald-100 text-emerald-700']">{{
                                                    item.branch.status==='aborted'?'Â∑≤‰∏≠Ê≠¢':(item.branch.finalDelayDays > 0
                                                    ? `Âª∂Ë™§ ${item.branch.finalDelayDays} Â§©` : 'Ê∫ñÊôÇ') }}</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 w-full">
                            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                <div
                                    class="px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                                    <h3 class="font-bold text-slate-700"><i
                                            class="fas fa-chart-pie mr-2 text-indigo-500"></i> ÂêÑÂñÆ‰ΩçÂ∑•ÊôÇÁµ±Ë®à</h3>
                                </div>
                                <div class="p-6">
                                    <div v-for="team in departmentHours" :key="team.name"
                                        class="flex items-center mb-3 last:mb-0">
                                        <div class="w-24 text-xs font-bold text-slate-500 uppercase mr-3">{{
                                            teamMap[team.name] || team.name }}</div>
                                        <div class="flex-1 h-2 bg-slate-100 rounded-full mr-3">
                                            <div class="h-2 bg-indigo-500 rounded-full"
                                                :style="{ width: (team.percent) + '%' }"></div>
                                        </div>
                                        <div class="w-16 text-right text-xs font-bold text-slate-700">{{ team.hours }} h
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col max-h-80">
                                <div
                                    class="px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                                    <h3 class="font-bold text-slate-700"><i
                                            class="fas fa-user-clock mr-2 text-indigo-500"></i> ‰∫∫Âì°Ë©≥Á¥∞Â∑•ÊôÇ</h3>
                                </div>
                                <div class="flex-1 overflow-y-auto p-0">
                                    <table class="w-full text-sm text-left">
                                        <thead class="text-xs text-slate-500 uppercase bg-slate-50 sticky top-0">
                                            <tr>
                                                <th class="px-6 py-2">ÊàêÂì°</th>
                                                <th class="px-6 py-2 text-right">Â∑•ÊôÇ</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-slate-100">
                                            <tr v-for="m in memberHoursStats" :key="m.name">
                                                <td class="px-6 py-2 text-slate-600 font-bold">
                                                    <span
                                                        class="text-[10px] bg-slate-100 border border-slate-200 text-slate-400 px-1.5 py-0.5 rounded mr-2 uppercase">{{
                                                        teamMap[m.team] }}</span>{{ m.name }}
                                                </td>
                                                <td class="px-6 py-2 text-right font-mono text-indigo-600 font-bold">{{
                                                    m.hours }} h</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="currentView === 'my_workspace'"
                        class="flex-1 flex flex-col h-full bg-slate-50 fade-in w-full">
                        <div class="px-8 pt-2 pb-4">
                            <div class="flex gap-4 border-b border-slate-200">
                                <button @click="workspaceTab = 'tasks'"
                                    :class="['px-4 py-2 font-bold text-sm transition border-b-2', workspaceTab==='tasks'?'border-indigo-600 text-indigo-600':'border-transparent text-slate-400 hover:text-slate-600']">ÂæÖËæ¶Ê∏ÖÂñÆ</button>
                                <button @click="workspaceTab = 'calendar'"
                                    :class="['px-4 py-2 font-bold text-sm transition border-b-2', workspaceTab==='calendar'?'border-indigo-600 text-indigo-600':'border-transparent text-slate-400 hover:text-slate-600']">Â∞àÊ°àË°å‰∫ãÊõÜ</button>
                            </div>
                        </div>

                        <div v-if="workspaceTab === 'tasks'" class="flex-1 overflow-y-auto px-8 pb-8">
                            <div class="mb-8">
                                <h3 class="text-lg font-bold text-indigo-700 mb-3 flex items-center"><i
                                        class="fas fa-hand-holding mr-2"></i> ÁõÆÂâçÂæÖËæ¶ (My Tasks) <span
                                        class="ml-2 text-xs bg-indigo-100 text-indigo-600 px-2 py-0.5 rounded-full">{{
                                        myHandledBranches.length }}</span></h3>
                                <div v-if="myHandledBranches.length === 0"
                                    class="text-slate-400 text-sm italic bg-white p-4 rounded-lg border border-slate-200 text-center">
                                    ÁõÆÂâçÊâã‰∏äÁÑ°ÂæÖËæ¶‰∫ãÈ†ÖÔºåÂéªÂñùÊùØÂíñÂï°ÂêßÔºÅ‚òï</div>
                                <div class="space-y-3">
                                    <div v-for="item in myHandledBranches" :key="item.sub.id"
                                        @click="selectSubProject(item.sub, item.parent)"
                                        class="flex items-center p-5 bg-white border rounded-xl hover:shadow-md cursor-pointer transition relative group"
                                        :class="getProjectHealth(item.sub).type !== 'normal' ? 'border-l-4 border-l-red-500 border-red-200 bg-red-50/10' : 'border-l-4 border-l-indigo-500 border-slate-200'">
                                        <div class="flex-1">
                                            <div class="text-xs text-slate-400 mb-1 flex items-center gap-2"><span
                                                    class="bg-slate-100 text-slate-600 px-1.5 py-0.5 rounded font-bold">{{
                                                    item?.brand?.name || 'Unknown' }}</span><i
                                                    class="fas fa-chevron-right text-[8px]"></i> {{ item.parent.title }}
                                            </div>
                                            <div class="font-bold text-lg text-slate-800 flex items-center">{{
                                                item.sub.title }} <span
                                                    v-if="getProjectHealth(item.sub).type === 'delay'"
                                                    class="ml-2 text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded font-bold border border-red-200 animate-pulse">Âª∂Ë™§
                                                    {{ getProjectHealth(item.sub).days }} Â§©</span><span
                                                    v-else-if="getProjectHealth(item.sub).type === 'lag'"
                                                    class="ml-2 text-[10px] bg-orange-100 text-orange-600 px-2 py-0.5 rounded font-bold border border-orange-200">ËêΩÂæå
                                                    {{ getProjectHealth(item.sub).days }} Â§©</span></div>
                                            <div class="text-xs text-indigo-600 mt-1 font-bold flex items-center"><i
                                                    class="fas fa-stopwatch mr-1"></i> Â∑≤ÊåÅÊúâ {{
                                                getDaysHeld(item.sub.lastHandoffDate) }} Â§©</div>
                                        </div>
                                        <div class="text-right text-xs text-slate-500 flex flex-col items-end">

                                            <div class="font-mono mb-1 font-bold"
                                                :class="getDateStyle(item.displayInfo.targetDate, item.sub.status)">
                                                {{ item.displayInfo.targetDate }}
                                            </div>

                                            <div class="px-2 py-1 rounded inline-block text-[10px] font-bold mb-1"
                                                :class="item.displayInfo.isMilestone ? 'bg-indigo-50 text-indigo-600 border border-indigo-100' : 'bg-slate-100 text-slate-500'">
                                                <i class="fas mr-1"
                                                    :class="item.displayInfo.isMilestone ? 'fa-flag' : 'fa-flag-checkered'"></i>
                                                {{ item.displayInfo.targetLabel }}
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-slate-600 mb-3 flex items-center"><i
                                        class="fas fa-user-tie mr-2"></i> ÊàëË≤†Ë≤¨ÁöÑÂ∞àÊ°à (Owned) <span
                                        class="ml-2 text-xs bg-slate-200 text-slate-600 px-2 py-0.5 rounded-full">{{
                                        myOwnedBranches.length }}</span></h3>
                                <div v-if="myOwnedBranches.length === 0"
                                    class="text-slate-400 text-sm italic bg-white p-4 rounded-lg border border-slate-200 text-center">
                                    ÁÑ°Ë≤†Ë≤¨Â∞àÊ°à</div>
                                <div class="space-y-3">
                                    <div v-for="item in myOwnedBranches"
                                        :key="item.isParent ? ('p'+item.project.id) : ('s'+item.sub.id)"
                                        @click="item.isParent ? selectParentProject(item.project) : selectSubProject(item.sub, item.parent)"
                                        class="flex items-center p-4 bg-white border border-slate-200 rounded-lg hover:shadow-sm cursor-pointer transition opacity-90 hover:opacity-100"
                                        :class="item.isParent ? 'bg-slate-50 border-l-4 border-l-slate-800' : ''">
                                        <div v-if="item.isParent" class="flex-1">
                                            <div class="flex items-center gap-2 mb-1"><span
                                                    class="text-[10px] bg-slate-800 text-white px-1.5 py-0.5 rounded uppercase font-bold">PARENT</span><span
                                                    class="text-xs text-slate-500 font-bold">{{ item?.brand?.name ||
                                                    'Unknown' }}</span></div>
                                            <div class="font-bold text-slate-800 text-lg">{{ item.project.title }}</div>
                                        </div>
                                        <div v-else class="flex-1">

                                            <div class="text-xs text-slate-400 flex items-center gap-1 mb-1"><span
                                                    class="bg-indigo-50 text-indigo-600 px-1.5 py-0.5 rounded font-bold">{{
                                                    item?.brand?.name || 'Unknown' }}</span><i
                                                    class="fas fa-chevron-right text-[8px]"></i><span>{{
                                                    item?.parent?.title || 'Unknown' }}</span></div>


                                            <div class="font-bold text-slate-700 flex items-center">{{ item.sub.title
                                                }}<span
                                                    v-if="!item.isParent && getProjectHealth(item.sub).type === 'delay'"
                                                    class="ml-2 bg-red-100 text-red-600 text-[10px] px-1 rounded">Âª∂ÈÅ≤ {{
                                                    getProjectHealth(item.sub).days }} Â§©</span><span
                                                    v-if="!item.isParent && getProjectHealth(item.sub).type === 'lag'"
                                                    class="ml-2 bg-orange-100 text-orange-600 text-[10px] px-1 rounded">ËêΩÂæå
                                                    {{ getProjectHealth(item.sub).days }} Â§©</span></div>
                                            <div class="text-xs text-slate-500 mt-1">ÁõÆÂâçËôïÁêÜÔºö<span
                                                    class="font-bold text-indigo-600">{{ item.sub.currentHandler
                                                    }}</span></div>
                                        </div>
                                        <div class="text-right text-xs">
                                            <div v-if="!item.isParent"
                                                :class="getProjectHealth(item.sub).type !== 'normal'?'text-red-500 font-bold':''">
                                                {{ item.sub.endDate }}</div>
                                            <div v-else class="text-slate-400">{{ item.project.endDate }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div v-if="workspaceTab === 'calendar'" class="flex-1 flex flex-col p-6 h-full relative">
                            <div class="calendar-wrapper bg-white flex flex-row h-full">
                                <div class="flex-1 flex flex-col border-r border-slate-200">
                                    <div class="px-6 py-4 border-b flex justify-between items-center bg-white">
                                        <h2 class="text-xl font-bold text-slate-800 flex items-center"><i
                                                class="fas fa-calendar-alt text-indigo-500 mr-3"></i> Â∞àÊ°àË°å‰∫ãÊõÜ</h2>
                                        <div class="flex items-center gap-3 bg-slate-100 rounded-lg p-1">
                                            <button @click="changeMonth(-1)"
                                                class="w-8 h-8 flex items-center justify-center hover:bg-white hover:shadow-sm rounded-md transition text-slate-500"><i
                                                    class="fas fa-chevron-left"></i></button>
                                            <span class="font-bold text-base w-32 text-center text-slate-700">{{
                                                calendarYear }}Âπ¥ {{ calendarMonth }}Êúà</span>
                                            <button @click="changeMonth(1)"
                                                class="w-8 h-8 flex items-center justify-center hover:bg-white hover:shadow-sm rounded-md transition text-slate-500"><i
                                                    class="fas fa-chevron-right"></i></button>
                                        </div>
                                        <div class="text-[10px] text-slate-400 font-bold">MS = Milestone (ÈáåÁ®ãÁ¢ë)</div>
                                    </div>
                                    <div class="flex-1 flex flex-col overflow-hidden">
                                        <div class="calendar-header">
                                            <div v-for="d in ['ÈÄ±Êó•','ÈÄ±‰∏Ä','ÈÄ±‰∫å','ÈÄ±‰∏â','ÈÄ±Âõõ','ÈÄ±‰∫î','ÈÄ±ÂÖ≠']" :key="d"
                                                class="calendar-header-cell">{{ d }}</div>
                                        </div>
                                        <div class="calendar-body no-scrollbar">
                                            <div v-for="(day, idx) in calendarDays" :key="idx"
                                                :class="['calendar-cell', day.isCurrentMonth ? 'bg-white' : 'other-month', day.isToday ? 'today' : '']">
                                                <div class="date-num">{{ day.date }}</div>
                                                <div class="flex-1 overflow-y-hidden space-y-1 px-1 pb-1">
                                                    <div v-for="ev in day.events.slice(0,3)" :key="ev.id"
                                                        @click.stop="openCalendarSideEvent(ev)"
                                                        :class="['event-pill', ev.type === 'deadline' ? (ev.sub.status==='completed' ? 'ep-deadline status-completed' : (getProjectHealth(ev.sub).type !== 'normal' ? 'ep-deadline status-delayed' : 'ep-deadline status-active')) : 'ep-milestone']"
                                                        :title="ev.title"><i class="fas mr-1 text-[8px]"
                                                            :class="ev.type==='deadline'?'fa-flag-checkered':'fa-map-marker-alt'"></i>
                                                        {{ ev.title }}</div>
                                                    <div v-if="day.events.length > 3"
                                                        class="text-[8px] text-slate-400 text-center font-bold">+{{
                                                        day.events.length - 3 }} more</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div v-if="calendarSideEvent"
                                    class="w-80 bg-white flex flex-col border-l border-slate-200 shadow-xl z-20 fade-in relative">
                                    <button @click="calendarSideEvent=null"
                                        class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i
                                            class="fas fa-times"></i></button>
                                    <div class="p-6 border-b border-slate-100">
                                        <div class="text-xs font-bold text-slate-400 uppercase mb-1">{{
                                            calendarSideEvent.type === 'deadline' ? 'Â∞àÊ°àÊà™Ê≠¢' : 'ÈáåÁ®ãÁ¢ëÁØÄÈªû' }}</div>
                                        <h3 class="text-xl font-bold text-slate-800 leading-tight">{{
                                            calendarSideEvent.title }}</h3>
                                    </div>
                                    <div class="p-6 space-y-4 flex-1 overflow-y-auto">
                                        <div>
                                            <div class="text-xs text-slate-400 font-bold mb-1">ÊâÄÂ±¨Â∞àÊ°à</div>
                                            <div class="text-sm font-bold text-indigo-600">{{
                                                calendarSideEvent.sub.title }}</div>
                                            <div class="text-xs text-slate-500">{{ calendarSideEvent.parent.title }}
                                            </div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-slate-400 font-bold mb-1">Ë≤†Ë≤¨‰∫∫</div>
                                            <div class="flex items-center">
                                                <div
                                                    class="w-6 h-6 rounded bg-slate-100 flex items-center justify-center text-xs mr-2">
                                                    {{ calendarSideEvent.sub.assignee.substring(0,1) }}</div>{{
                                                calendarSideEvent.sub.assignee }}
                                            </div>
                                        </div>
                                        <div>
                                            <div class="text-xs text-slate-400 font-bold mb-1">ÁõÆÂâçÁãÄÊÖã</div><span
                                                :class="['px-2 py-1 rounded text-xs font-bold', statusBadge(calendarSideEvent.sub.status)]">{{
                                                statusMap[calendarSideEvent.sub.status] }}</span>
                                        </div>
                                        <div v-if="getProjectHealth(calendarSideEvent.sub).type !== 'normal'"
                                            class="bg-red-50 p-3 rounded border border-red-100">
                                            <div class="text-xs font-bold text-red-600 mb-1">Áï∞Â∏∏Ë≠¶Á§∫</div>
                                            <div class="text-sm text-red-700 font-bold">{{
                                                getProjectHealth(calendarSideEvent.sub).type === 'delay' ? 'Â∑≤Âª∂Ë™§' :
                                                'ÈÄ≤Â∫¶ËêΩÂæå' }} {{ getProjectHealth(calendarSideEvent.sub).days }} Â§©</div>
                                        </div>
                                    </div>
                                    <div class="p-4 border-t border-slate-100 bg-slate-50"><button
                                            @click="selectSubProject(calendarSideEvent.sub, calendarSideEvent.parent)"
                                            class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg font-bold text-sm shadow">Êü•ÁúãÂÆåÊï¥Ë©≥ÊÉÖ</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="currentView === 'parent_detail'"
                        class="flex-1 flex flex-col bg-white overflow-hidden w-full fade-in">
                        <div
                            class="bg-white border-b border-slate-200 px-8 py-6 shadow-sm z-10 flex flex-col md:flex-row md:items-start md:justify-between gap-4">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">

                                    <div class="flex items-center text-xs text-slate-500 hover:text-indigo-600 cursor-pointer transition w-fit group"
                                        @click="goBack">
                                        <i
                                            class="fas fa-arrow-left mr-2 group-hover:-translate-x-1 transition-transform"></i>
                                        <span>ËøîÂõû‰∏ä‰∏ÄÈ†Å</span>
                                    </div>

                                    <span
                                        class="ml-4 bg-blue-100 px-1.5 py-0.5 rounded text-[10px] font-bold text-blue-600 cursor-default">
                                        {{ indexedBrandMap[currentParentProject.brandId] || 'Brand' }}
                                    </span>
                                    <span class="mx-2 text-slate-300"><i class="fas fa-chevron-right"></i></span>

                                </div>

                                <h2
                                    class="text-3xl font-bold text-slate-900 tracking-tight leading-tight flex items-center group">
                                    {{ currentParentProject.title }}
                                    <button @click="editParentTitle"
                                        class="ml-3 text-sm text-slate-300 hover:text-indigo-600 transition"
                                        title="‰øÆÊîπÂêçÁ®±">
                                        <i class="fas fa-pen"></i>
                                    </button>
                                    <span v-if="currentParentProject.status==='aborted'"
                                        class="ml-2 bg-slate-200 text-slate-600 text-sm px-2 py-0.5 rounded align-middle font-medium">Â∑≤‰∏≠Ê≠¢</span>
                                    <span v-if="currentParentProject.status==='completed'"
                                        class="ml-2 bg-emerald-100 text-emerald-700 text-sm px-2 py-0.5 rounded align-middle font-medium">Â∑≤Ê≠∏Ê™î</span>
                                </h2>
                                <div class="mt-2 flex items-center gap-4 text-sm text-slate-500">

                                    <span
                                        class="bg-slate-100 px-2 py-0.5 rounded font-mono text-xs border border-slate-200">
                                        ID: {{ currentParentProject.id.substring(0,200) }}
                                    </span>

                                    <span class="flex items-center">
                                        <i class="far fa-calendar-alt mr-2"></i>

                                        <input type="date" v-model="currentParentProject.startDate"
                                            @change="updateParentDates" :disabled="currentUser.role !== 'admin'"
                                            class="bg-transparent border-b border-dashed border-slate-300 focus:border-indigo-500 outline-none text-slate-600 font-mono text-xs w-24 mr-1 disabled:border-none disabled:text-slate-500 disabled:bg-transparent transition-colors hover:border-indigo-300"
                                            title="Â∞àÊ°àÈñãÂßãÊó• (AdminÂèØÁ∑®ËºØ)">

                                        <span class="mx-1">~</span>

                                        <input type="date" v-model="currentParentProject.endDate"
                                            @change="updateParentDates" :disabled="currentUser.role !== 'admin'"
                                            class="bg-transparent border-b border-dashed border-slate-300 focus:border-indigo-500 outline-none text-slate-600 font-mono text-xs w-24 ml-1 disabled:border-none disabled:text-slate-500 disabled:bg-transparent transition-colors hover:border-indigo-300"
                                            title="Â∞àÊ°àÁµêÊùüÊó• (AdminÂèØÁ∑®ËºØ)">
                                    </span>

                                    <span class="flex items-center"><i class="far fa-user-circle mr-1.5"></i> {{
                                        currentParentProject.owner }}</span>
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-2 items-start justify-end">
                                <button
                                    v-if="(currentUser.role==='director' || currentUser.name===currentParentProject.owner) && currentParentProject.status==='active'"
                                    @click="openParentAbortModal"
                                    class="bg-slate-100 hover:bg-slate-200 text-slate-600 border border-slate-300 px-4 py-2 rounded-lg font-bold text-sm transition flex items-center"><i
                                        class="fas fa-ban mr-2"></i> ‰∏≠Ê≠¢ÂÖ®Ê°à</button>
                                <button
                                    v-if="(currentUser.role==='director' || currentUser.name===currentParentProject.owner) && currentParentProject.status==='active'"
                                    @click="completeParentProject(currentParentProject)"
                                    class="bg-white hover:bg-emerald-50 text-emerald-600 border border-emerald-200 px-4 py-2 rounded-lg font-bold text-sm transition flex items-center shadow-sm"><i
                                        class="fas fa-check-circle mr-2"></i> ÂÖ®Ê°àÊ≠∏Ê™î</button>

                                <button type="button" v-if="currentParentProject.status==='active'"
                                    @click.stop="openBranchModal(currentParentProject.id)"
                                    class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-bold text-sm shadow-md transition flex items-center">
                                    <i class="fas fa-plus mr-2"></i> ÈñãÁ´ãÂ≠êÂ∞àÊ°à
                                </button>
                                <button v-if="currentUser.role === 'admin'" @click="adminDeleteParent"
                                    class="bg-red-600 hover:bg-red-700 text-white border border-red-700 px-4 py-2 rounded-lg font-bold text-sm transition flex items-center shadow-sm ml-2">
                                    <i class="fas fa-trash-alt mr-2"></i> Âº∑Âà∂Âà™Èô§
                                </button>
                            </div>
                        </div>
                        <div class="flex mt-0 bg-white border-b border-slate-200 px-8">
                            <button @click="detailTab = 'overview'"
                                :class="['px-4 py-3 text-sm font-bold border-b-2 transition -mb-[2px]', detailTab==='overview'?'border-indigo-600 text-indigo-600':'border-transparent text-slate-500 hover:text-slate-800 hover:border-slate-300']">Â∞àÊ°àÁ∏ΩË¶Ω</button>
                            <button @click="detailTab = 'gantt'"
                                :class="['px-4 py-3 text-sm font-bold border-b-2 transition -mb-[2px]', detailTab==='gantt'?'border-indigo-600 text-indigo-600':'border-transparent text-slate-500 hover:text-slate-800 hover:border-slate-300']">ÁîòÁâπÂúñ
                                (Gantt)</button>
                        </div>

                        <div class="flex-1 overflow-y-auto p-8 bg-slate-50/50 w-full">
                            <div v-if="detailTab === 'overview'">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10 w-full">
                                    <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200"><span
                                            class="text-xs font-bold text-slate-400">Á∏ΩÂØ¶ÈöõÂ∑•ÊôÇ</span>
                                        <div class="mt-2 text-3xl font-bold text-blue-600">{{ currentProjectStats.act ||
                                            0 }} <span class="text-sm font-medium text-slate-400">hours</span></div>
                                    </div>
                                    <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200"><span
                                            class="text-xs font-bold text-slate-400">Á∏ΩÈÄ≤Â∫¶</span>
                                        <div class="mt-2 text-3xl font-bold text-indigo-600">{{
                                            currentProjectStats.progress || 0 }}%</div>
                                        <div class="w-full bg-slate-100 rounded-full h-1.5 mt-2">
                                            <div class="bg-indigo-500 h-1.5 rounded-full"
                                                :style="{width: (currentProjectStats.progress||0)+'%'}"></div>
                                        </div>
                                    </div>
                                    <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200"><span
                                            class="text-xs font-bold text-slate-400">Ââ©È§òÂ§©Êï∏ / Âª∂Ë™§</span>
                                        <div class="mt-2 text-3xl font-bold"
                                            :class="getDeadlineStatus(currentParentProject.endDate).status==='overdue'?'text-red-600':'text-slate-800'">
                                            {{ getDeadlineStatus(currentParentProject.endDate).label }}</div>
                                    </div>
                                    <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200"><span
                                            class="text-xs font-bold text-slate-400">ÂÆåÊàê/Á∏ΩÊï∏</span>
                                        <div class="mt-2 text-3xl font-bold text-slate-800">{{
                                            currentProjectStats.completed || 0 }} <span class="text-slate-300">/</span>
                                            {{ currentProjectStats.total || 0 }}</div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 w-full">
                                    <div v-if="getSortedSubs(currentParentProject.id).length === 0"
                                        class="text-center w-full col-span-full py-10 text-slate-400 italic border-2 border-dashed border-slate-200 rounded-lg">
                                        Â∞öÁÑ°Â≠êÂ∞àÊ°à</div>
                                    <div v-for="branch in getSortedSubs(currentParentProject.id)" :key="branch.id"
                                        @click="selectSubProject(branch, currentParentProject)"
                                        class="bg-white rounded-xl p-5 cursor-pointer shadow-sm hover:shadow-md transition border border-slate-200 hover:-translate-y-1 relative"
                                        :class="branch.status==='aborted'?'opacity-60':(getProjectHealth(branch).type==='delay'?'border-red-300 ring-1 ring-red-100':'')">
                                        <div class="flex justify-between items-start mb-4">
                                            <div>
                                                <h3
                                                    class="font-bold text-lg text-slate-800 group-hover:text-indigo-600">
                                                    {{ branch.title }}</h3>
                                                <div class="text-xs text-slate-500 mt-1 flex gap-2"><span>üë§ Ë≤†Ë≤¨: {{
                                                        branch.assignee }}</span><span>‚ö° Âü∑Ë°å: {{ branch.currentHandler
                                                        }}</span></div>
                                            </div><span
                                                :class="['px-2 py-1 rounded text-[10px] font-bold uppercase h-fit', statusBadge(branch.status)]">{{
                                                statusMap[branch.status] }}</span>
                                        </div>
                                        <div class="mt-4 pt-4 border-t border-slate-100">
                                            <div class="flex justify-between text-xs text-slate-500 mb-2">
                                                <span :class="getDateStyle(branch.endDate, branch.status)">
                                                    {{ branch.endDate }} <span v-if="getSubProjectDelayDays(branch) > 0"
                                                        class="ml-1 bg-red-100 text-red-600 px-1 rounded font-bold">Âª∂ {{
                                                        getSubProjectDelayDays(branch) }} Â§©</span></span><span
                                                    class="font-bold text-blue-600">{{ calcSubProjectHours(branch)
                                                    }}h</span>
                                            </div>
                                            <div class="w-full bg-slate-100 rounded-full h-1.5">
                                                <div class="bg-emerald-500 h-1.5 rounded-full"
                                                    :style="{width: getBranchProgress(branch).percent+'%'}"></div>
                                            </div>
                                        </div>
                                        <div v-if="branch.delayReason"
                                            class="mt-2 bg-red-50 p-2 rounded text-[10px] text-red-600 font-bold border border-red-100">
                                            <i class="fas fa-exclamation-circle mr-1"></i> ÂéüÂõ†: {{ branch.delayReason }}
                                        </div>
                                        <div v-if="branch.status==='aborted'"
                                            class="absolute top-0 right-0 bg-slate-600 text-white text-[10px] px-2 py-1 rounded-bl-lg font-bold shadow-sm">
                                            ‰∏≠Ê≠¢</div>
                                        <div v-else-if="getProjectHealth(branch).type === 'delay'"
                                            class="absolute top-0 right-0 bg-red-500 text-white text-[10px] px-2 py-1 rounded-bl-lg font-bold shadow-sm">
                                            Âª∂ÈÅ≤ {{ getProjectHealth(branch).days }} Â§©</div>
                                        <div v-else-if="getProjectHealth(branch).type === 'lag'"
                                            class="absolute top-0 right-0 bg-orange-400 text-white text-[10px] px-2 py-1 rounded-bl-lg font-bold shadow-sm">
                                            ËêΩÂæå {{ getProjectHealth(branch).days }} Â§©</div>
                                    </div>
                                </div>
                            </div>

                            <div v-if="detailTab === 'gantt'"
                                class="bg-white p-0 rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-[600px]">
                                <div
                                    class="px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                                    <h3 class="font-bold text-slate-700">Â∞àÊ°àÊéíÁ®ãÁ∏ΩË¶Ω (ÂèØÂ∑¶Âè≥ÊãñÊõ≥)</h3>
                                    <div class="flex items-center gap-2">
                                        <button @click="changeGanttZoom(-10)"
                                            class="w-8 h-8 rounded bg-white border border-slate-300 hover:bg-slate-50 flex items-center justify-center text-slate-500"><i
                                                class="fas fa-search-minus"></i></button>
                                        <button @click="changeGanttZoom(10)"
                                            class="w-8 h-8 rounded bg-white border border-slate-300 hover:bg-slate-50 flex items-center justify-center text-slate-500"><i
                                                class="fas fa-search-plus"></i></button>
                                    </div>
                                </div>
                                <div class="flex-1 overflow-hidden relative">
                                    <div ref="ganttContainer" class="gantt-scroll-container h-full w-full"
                                        @mousedown="startDrag" @mousemove="doDrag" @mouseup="stopDrag"
                                        @mouseleave="stopDrag">
                                        <div class="gantt-header-row"
                                            :style="{ width: (220 + getGanttDays(currentParentProject).length * ganttCellWidth) + 'px' }">
                                            <div class="gantt-label-col">Â≠êÂ∞àÊ°àÂêçÁ®±</div>
                                            <div v-for="day in getGanttDays(currentParentProject)" :key="day.iso"
                                                :style="{ width: ganttCellWidth + 'px' }"
                                                :class="['gantt-day-cell', day.isWeekend ? 'weekend' : '']">{{ day.label
                                                }}</div>
                                        </div>
                                        <div v-for="sp in getSubsForParent(currentParentProject.id)" :key="sp.id"
                                            class="gantt-row"
                                            :style="{ width: (220 + getGanttDays(currentParentProject).length * ganttCellWidth) + 'px' }">
                                            <div class="gantt-label-col truncate" :title="sp.title">{{ sp.title }}</div>
                                            <div class="gantt-timeline-area flex-1">
                                                <div v-for="day in getGanttDays(currentParentProject)"
                                                    :key="'bg'+day.iso" :style="{ width: ganttCellWidth + 'px' }"
                                                    :class="['gantt-day-cell', day.isWeekend ? 'weekend' : '']"></div>
                                                <div :class="['gantt-bar', getProjectHealth(sp).type==='delay'?'bg-red-500':(sp.status==='completed'?'bg-emerald-500':'bg-indigo-500')]"
                                                    :style="getDynamicGanttBarStyles(sp, currentParentProject)">{{
                                                    sp.title }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="currentView === 'sub_project_detail'"
                        class="flex-1 flex flex-col h-full bg-white w-full fade-in">
                        <div class="border-b border-slate-200 px-8 py-6 bg-white w-full shadow-sm z-10">
                            <div class="flex items-center gap-2 mb-4 bg-slate-50 p-2 rounded-lg border border-slate-100"
                                v-if="currentSubProject.links && currentSubProject.links.length > 0">
                                <span class="text-[10px] font-bold text-slate-400 uppercase mr-2">Ë≥áÊ∫êÈÄ£Áµê:</span>
                                <a v-for="l in currentSubProject.links" :key="l.url" :href="l.url" target="_blank"
                                    class="flex items-center text-xs text-indigo-600 hover:text-indigo-800 bg-white px-2 py-1 rounded border border-indigo-100 hover:border-indigo-300 transition">
                                    <i class="fas fa-link mr-1"></i> {{ l.title }}
                                </a>
                            </div>

                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center text-xs text-slate-500">
                                    <div class="flex items-center text-xs text-slate-500 hover:text-indigo-600 cursor-pointer transition w-fit group"
                                        @click="goBack">
                                        <i
                                            class="fas fa-arrow-left mr-2 group-hover:-translate-x-1 transition-transform"></i>
                                        <span>ËøîÂõû‰∏ä‰∏ÄÈ†Å</span>
                                    </div>

                                    <span
                                        class="ml-4 bg-blue-100 px-1.5 py-0.5 rounded text-[10px] font-bold text-blue-600 cursor-default">

                                        {{ indexedBrandMap[currentParentProject?.brandId] || 'Brand' }}
                                    </span>

                                    </span>
                                    <span class="mx-2 text-slate-300"><i class="fas fa-chevron-right"></i></span>

                                    <button @click="selectParentProject(currentParentProject)"
                                        class="hover:text-indigo-600 hover:underline cursor-pointer flex items-center transition-colors font-medium text-slate-600">
                                        <i class="fas fa-folder mr-1"></i>
                                        {{ currentParentProject?.title || 'Unknown Parent' }}
                                    </button>

                                    </span>
                                    <span class="mx-2 text-slate-300"><i class="fas fa-chevron-right"></i></span>

                                </div>

                                <div class="flex items-center gap-2">
                                    <span v-if="currentSubProject.status === 'setup'"
                                        class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs font-bold animate-pulse">Ë¶èÂäÉ‰∏≠
                                        (Setup)</span>
                                    <span v-if="currentSubProject.status === 'in_progress'"
                                        class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-xs font-bold">Âü∑Ë°å‰∏≠</span>
                                    <span v-if="currentSubProject.status === 'completed'"
                                        class="bg-emerald-100 text-emerald-700 px-3 py-1 rounded-full text-xs font-bold">Â∑≤ÁµêÊ°à</span>
                                    <span v-if="currentSubProject.status === 'aborted'"
                                        class="bg-slate-600 text-white px-3 py-1 rounded-full text-xs font-bold">Â∑≤‰∏≠Ê≠¢</span>
                                    <span v-if="getProjectHealth(currentSubProject).type === 'delay'"
                                        class="bg-red-100 text-red-600 px-3 py-1 rounded-full text-xs font-bold border border-red-200">
                                        <i class="fas fa-clock mr-1"></i> Âª∂Ë™§ {{ getProjectHealth(currentSubProject).days
                                        }} Â§©
                                    </span>
                                    <div v-if="currentUser.role === 'admin'"
                                        class="flex gap-2 ml-2 border-l pl-2 border-slate-300">
                                        <button @click="adminMoveSubProject"
                                            class="text-xs bg-orange-500 hover:bg-orange-600 text-white px-3 py-1.5 rounded transition shadow-sm">
                                            <i class="fas fa-exchange-alt mr-1"></i> Êê¨Áßª
                                        </button>
                                        <button @click="adminDeleteSub"
                                            class="text-xs bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 rounded transition shadow-sm">
                                            <i class="fas fa-trash mr-1"></i> Âà™Èô§
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="flex justify-between items-start">
                                <div>
                                    <h2 class="text-2xl font-bold text-slate-800 mb-2 flex items-center group">
                                        {{ currentSubProject.title }}
                                        <button v-if="canEditSubProject" @click="editSubProjectTitle"
                                            class="ml-2 text-xs text-slate-300 hover:text-indigo-600 opacity-0 group-hover:opacity-100 transition"
                                            title="‰øÆÊîπÂ∞àÊ°àÂêçÁ®±">
                                            <i class="fas fa-pen"></i>
                                        </button>
                                        <button v-if="canEditSubProject" @click="addResourceLink"
                                            class="ml-3 text-xs bg-slate-100 text-slate-500 w-6 h-6 rounded-full hover:bg-indigo-50 hover:text-indigo-600 transition"
                                            title="Êñ∞Â¢ûÈÄ£Áµê">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </h2>
                                    <div class="flex items-center space-x-6 text-sm text-slate-600">
                                        <div
                                            class="flex items-center bg-slate-100 px-3 py-1.5 rounded-lg border border-slate-200">
                                            <span class="text-xs font-bold text-slate-400 mr-2 uppercase">Ë≤†Ë≤¨‰∫∫</span>
                                            <i class="fas fa-user-circle mr-1 text-slate-500"></i>
                                            <span class="font-bold text-slate-700">{{ currentSubProject.assignee
                                                }}</span>
                                        </div>
                                        <div
                                            class="flex items-center bg-indigo-50 px-3 py-1.5 rounded-lg border border-indigo-100">
                                            <span class="text-xs font-bold text-indigo-400 mr-2 uppercase">ÁõÆÂâçËôïÁêÜ</span>
                                            <i class="fas fa-hand-holding mr-1 text-indigo-500"></i>
                                            <span class="font-bold text-indigo-700">{{ currentSubProject.currentHandler
                                                || currentSubProject.assignee }}</span>
                                        </div>
                                    </div>
                                    <div class="text-xs text-slate-400 mt-2">Ëµ∑ËøÑ: {{ currentSubProject.startDate || 'Êú™ÂÆö'
                                        }} ~ {{ currentSubProject.endDate || 'Êú™ÂÆö' }}</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-3xl font-bold text-blue-600">{{
                                        calcSubProjectHours(currentSubProject) }} <span
                                            class="text-sm text-slate-400 font-medium">hours</span></div>
                                    <div class="flex gap-2 mt-2 justify-end">
                                        <template
                                            v-if="currentSubProject.status === 'in_progress' && currentUser.name === currentSubProject.currentHandler && !currentSubProject.isWaitingForManager">
                                            <button @click="startManagerCheck"
                                                class="text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1.5 rounded font-bold transition flex items-center shadow-sm">
                                                <i class="fas fa-user-tie mr-1"></i> Êèê‰∫§‰∏ªÁÆ°Á¢∫Ë™ç
                                            </button>
                                        </template>

                                        <template v-if="currentSubProject.isWaitingForManager">
                                            <div class="flex items-center gap-2 animate-pulse">
                                                <span
                                                    class="text-xs font-bold text-orange-600 bg-orange-50 px-3 py-1.5 rounded border border-orange-100">
                                                    <i class="fas fa-clock mr-1"></i> Á≠âÂæÖ‰∏ªÁÆ°Á¢∫Ë™ç‰∏≠... (Êö´ÂÅúË®àÊôÇ)
                                                </span>
                                            </div>
                                            <button @click="finishManagerCheck"
                                                class="text-xs bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-1.5 rounded font-bold transition flex items-center shadow-sm">
                                                <i class="fas fa-check-double mr-1"></i> ‰∏ªÁÆ°Â∑≤Á¢∫Ë™ç/ÂõûË¶Ü
                                            </button>
                                        </template>

                                        <button v-if="currentSubProject.status === 'in_progress' && canEditSubProject"
                                            @click="openEditBranchModal"
                                            class="text-xs bg-slate-100 hover:bg-slate-200 text-slate-600 px-3 py-1.5 rounded font-bold transition flex items-center">
                                            <i class="fas fa-cog mr-1"></i> Ë®≠ÂÆö
                                        </button>

                                        <button v-if="currentSubProject.status === 'in_progress' && canEditSubProject"
                                            @click="openSubAbortModal"
                                            class="text-xs bg-slate-500 hover:bg-slate-600 text-white px-3 py-1.5 rounded transition">
                                            ‚õî ‰∏≠Ê≠¢Â∞àÊ°à
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div v-if="currentSubProject.delayReason"
                                class="mt-4 bg-red-50 border-l-4 border-red-500 p-4 rounded-r-lg">
                                <div class="flex">
                                    <div class="flex-shrink-0"><i class="fas fa-exclamation-triangle text-red-500"></i>
                                    </div>
                                    <div class="ml-3">
                                        <h3 class="text-sm font-bold text-red-800">Âª∂ÈÅ≤ÁµêÊ°àÂéüÂõ†Ôºö{{
                                            currentSubProject.delayReason }}</h3>
                                        <div class="mt-1 text-sm text-red-700">{{ currentSubProject.delayRemark }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex mt-6 space-x-1 border-b border-slate-200 px-8">
                            <button @click="detailTab = 'events'"
                                :class="['px-4 py-2 text-sm font-bold border-b-2 transition', detailTab==='events'?'border-indigo-600 text-indigo-600':'border-transparent text-slate-400 hover:text-slate-600']">Â∑•‰ΩúÊó•Ë™å</button>
                            <button @click="detailTab = 'comments'"
                                :class="['px-4 py-2 text-sm font-bold border-b-2 transition', detailTab==='comments'?'border-indigo-600 text-indigo-600':'border-transparent text-slate-400 hover:text-slate-600']">ÁïôË®ÄË®éË´ñ
                                ({{ currentSubProject.comments?.length || 0 }})</button>
                        </div>
                        <div class="flex-1 overflow-y-auto p-8 w-full bg-slate-50/50">
                            <div class="w-full max-w-5xl mx-auto">
                                <div v-if="currentSubProject.status === 'setup'">
                                    <template v-if="currentSubProject.assignee === currentUser.name">
                                        <div class="bg-white p-8 rounded-xl shadow-lg border border-indigo-100 mb-8">
                                            <h3 class="font-bold text-lg text-slate-800 mb-4 border-b pb-2">Step 1:
                                                Â∞àÊ°àË¶èÂäÉËàáÈáåÁ®ãÁ¢ëË®≠ÂÆö</h3>
                                            <div class="grid grid-cols-2 gap-6 mb-6">
                                                <div>
                                                    <label class="block text-xs font-bold text-slate-500 mb-1">Â≠êÂ∞àÊ°àÈñãÂßãÊó•
                                                        (Default: Today)</label>
                                                    <input type="date" v-model="setupForm.startDate"
                                                        class="w-full border rounded-lg px-3 py-2">
                                                </div>
                                                <div>
                                                    <label
                                                        class="block text-xs font-bold text-slate-500 mb-1">Â≠êÂ∞àÊ°àÁµêÊùüÊó•</label>
                                                    <input type="date" v-model="setupForm.endDate"
                                                        class="w-full border rounded-lg px-3 py-2 disabled:bg-slate-50 disabled:text-slate-400 cursor-not-allowed"
                                                        disabled>
                                                </div>
                                            </div>
                                            <div class="mb-6">
                                                <div class="flex justify-between items-center mb-2">
                                                    <label class="block text-xs font-bold text-slate-500">ÈáåÁ®ãÁ¢ë
                                                        (Milestones)</label>
                                                    <button @click="addSetupMilestone"
                                                        class="text-xs bg-slate-100 hover:bg-slate-200 px-2 py-1 rounded">+
                                                        Êñ∞Â¢ûÁØÄÈªû</button>
                                                </div>
                                                <div v-for="(m, idx) in setupForm.milestones" :key="idx"
                                                    class="flex gap-2 mb-2">
                                                    <input type="date" v-model="m.date"
                                                        class="border rounded px-2 py-1 text-sm">
                                                    <input v-model="m.title" placeholder="ÁØÄÈªûÊ®ôÈ°å"
                                                        class="flex-1 border rounded px-2 py-1 text-sm">
                                                    <button @click="setupForm.milestones.splice(idx,1)"
                                                        class="text-red-400 hover:text-red-600"><i
                                                            class="fas fa-times"></i></button>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <button @click="confirmSetup" :disabled="isSubmitting"
                                                    class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold shadow hover:bg-indigo-700 disabled:opacity-50">Á¢∫Ë™çË¶èÂäÉ‰∏¶ÈñãÊ°à</button>
                                            </div>
                                        </div>
                                    </template>
                                    <div v-else
                                        class="text-center py-12 bg-white rounded-xl shadow-sm border border-slate-200">
                                        <i class="fas fa-user-lock text-4xl text-slate-300 mb-4"></i>
                                        <h3 class="text-lg font-bold text-slate-600">Á≠âÂæÖË≤†Ë≤¨‰∫∫Ë¶èÂäÉ</h3>
                                        <p class="text-slate-400 text-xs mt-2">Ê≠§Â∞àÊ°àÈúÄÁî± <span
                                                class="font-bold text-indigo-500">{{ currentSubProject.assignee
                                                }}</span> Ë®≠ÂÆöÈáåÁ®ãÁ¢ëÂæåÊñπÂèØÂü∑Ë°å„ÄÇ</p>
                                    </div>
                                </div>
                                <div v-else>
                                    <div class="mb-8">
                                        <div class="flex justify-between items-center mb-4">
                                            <h3 class="font-bold text-slate-700 text-sm uppercase tracking-wide">È†êÂÆöÈáåÁ®ãÁ¢ë
                                            </h3>

                                            <button v-if="currentUser.role === 'admin'" @click="addMilestone"
                                                class="text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded transition shadow-sm">
                                                <i class="fas fa-plus mr-1"></i> Êñ∞Â¢ûÁØÄÈªû
                                            </button>
                                        </div>

                                        <div class="relative pl-6 space-y-0">
                                            <div v-if="sortedMilestones.length===0"
                                                class="text-slate-400 text-sm italic">ÁÑ°Ë®≠ÂÆöÈáåÁ®ãÁ¢ë</div>

                                            <div v-for="(ms, index) in sortedMilestones" :key="ms.id"
                                                class="relative pl-10 pb-8 group"
                                                :class="{'last-node': index === sortedMilestones.length - 1}">

                                                <div class="node-line"></div>

                                                <div class="absolute left-0 top-1 w-8 h-8 rounded-full border-4 shadow-sm flex items-center justify-center bg-white"
                                                    :class="ms.isCompleted ? 'border-emerald-500 text-emerald-500' : (isMilestoneOverdue(ms) ? 'border-orange-400 text-orange-500' : 'border-slate-300 text-slate-300')">
                                                    <i v-if="ms.isCompleted" class="fas fa-check text-xs"></i>
                                                    <i v-else-if="isMilestoneOverdue(ms)"
                                                        class="fas fa-exclamation text-xs"></i>
                                                    <div v-else class="w-2 h-2 rounded-full bg-current"></div>
                                                </div>

                                                <div class="bg-white border rounded-lg p-4 shadow-sm flex justify-between items-center relative"
                                                    :class="ms.isCompleted ? 'border-emerald-200 bg-emerald-50/30' : 'border-slate-200'">

                                                    <button v-if="currentUser.role === 'admin'"
                                                        @click="deleteMilestone(ms.id)"
                                                        class="absolute top-2 right-2 text-slate-300 hover:text-red-500 transition px-2"
                                                        title="Âà™Èô§ÁØÄÈªû (Admin)">
                                                        <i class="fas fa-trash-alt"></i>
                                                    </button>

                                                    <div>
                                                        <div v-if="currentUser.role === 'admin'" class="mb-1">
                                                            <input type="text" v-model="ms.title"
                                                                @change="updateMilestone"
                                                                class="font-bold text-slate-800 bg-transparent border-b border-dashed border-slate-300 focus:border-indigo-500 outline-none w-full"
                                                                title="ÈªûÊìä‰øÆÊîπÊ®ôÈ°å">
                                                        </div>
                                                        <div v-else class="font-bold text-slate-800"
                                                            :class="ms.isCompleted?'line-through text-slate-400':''">
                                                            {{ ms.title }}
                                                        </div>

                                                        <div class="text-xs text-slate-500 mt-1 flex items-center">
                                                            <i class="far fa-calendar-alt mr-2"></i>

                                                            <input type="date" v-model="ms.date"
                                                                @change="updateMilestone"
                                                                :disabled="currentUser.role !== 'admin'"
                                                                class="bg-transparent border-b border-dashed border-slate-300 focus:border-indigo-500 outline-none text-slate-600 font-mono text-xs w-24 mr-1 disabled:border-none disabled:text-slate-500 disabled:bg-transparent transition-colors hover:border-indigo-300"
                                                                title="È†êÂÆöÊó•Êúü (AdminÂèØÊîπ)">

                                                            <span v-if="ms.isCompleted"
                                                                class="ml-2 text-emerald-600 font-bold">(Â∑≤ÂÆåÊàê)</span>
                                                            <span v-else-if="isMilestoneOverdue(ms)"
                                                                class="ml-2 text-orange-500 font-bold">Â∑≤ËêΩÂæå {{
                                                                getDaysLate(ms.date) }} Â§© (Ë≠¶Á§∫)</span>
                                                        </div>
                                                    </div>

                                                    <div v-if="ms.isCompleted" class="text-right mt-4 sm:mt-0">

                                                        <div class="mb-1 text-xs text-slate-500">
                                                            <span class="mr-1">ÂÆåÊàêÊñº:</span>
                                                            <input type="date" v-model="ms.completedDate"
                                                                @change="updateMilestone"
                                                                :disabled="currentUser.role !== 'admin'"
                                                                class="bg-transparent border-b border-dashed border-slate-300 focus:border-emerald-500 outline-none text-emerald-700 font-bold font-mono text-xs w-24 text-right disabled:border-none disabled:text-emerald-600 disabled:bg-transparent hover:border-emerald-300"
                                                                title="ÂØ¶ÈöõÂÆåÊàêÊó• (AdminÂèØÊîπ)">
                                                        </div>

                                                        <div class="mb-1">
                                                            <span
                                                                class="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-0.5 rounded border border-blue-100">
                                                                <i class="fas fa-hammer mr-1"></i>{{
                                                                getMilestoneHours(currentSubProject, ms.id) }} h
                                                            </span>
                                                        </div>

                                                        <div>
                                                            <span v-if="ms.diffDays < 0"
                                                                class="text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded font-bold">ÊèêÊó©
                                                                {{ Math.abs(ms.diffDays) }} Â§©</span>
                                                            <span v-else-if="ms.diffDays > 0"
                                                                class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded font-bold">Âª∂ÈÅ≤
                                                                {{ ms.diffDays }} Â§©</span>
                                                            <span v-else
                                                                class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded font-bold">Ê∫ñÊôÇÂÆåÊàê</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div v-if="detailTab === 'events'"
                                    class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                    <div
                                        class="px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center">
                                        <h3 class="font-bold text-slate-700">Â∑•‰ΩúÊó•Ë™åËàáÂåπÈÖç (Events)</h3>
                                        <button v-if="currentSubProject.status === 'in_progress' && canEditSubProject"
                                            @click="openEventModal"
                                            class="text-xs bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded shadow flex items-center">
                                            <i class="fas fa-pen mr-2"></i> Êñ∞Â¢ûÂ∑•‰ΩúÊó•Ë™å / ‰∫§Êé•
                                        </button>
                                    </div>
                                    <div class="p-0">
                                        <table class="w-full text-sm text-left">
                                            <thead class="text-xs text-slate-500 uppercase bg-slate-50 border-b">
                                                <tr>
                                                    <th class="px-6 py-3">Êó•Êúü</th>
                                                    <th class="px-6 py-3">Âü∑Ë°å‰∫∫Âì°</th>
                                                    <th class="px-6 py-3">ÂÖßÂÆπ</th>
                                                    <th class="px-6 py-3 text-center">Â∑•ÊôÇ</th>
                                                    <th class="px-6 py-3">ÂåπÈÖçÁØÄÈªû</th>
                                                </tr>
                                            </thead>
                                            <tbody class="divide-y divide-slate-100">
                                                <tr
                                                    v-if="!currentSubProject.events || currentSubProject.events.length===0">
                                                    <td colspan="5" class="px-6 py-8 text-center text-slate-400 italic">
                                                        Â∞öÁÑ°Â∑•‰ΩúË®òÈåÑ</td>
                                                </tr>
                                                <tr v-for="ev in (currentSubProject.events || [])" :key="ev.id">
                                                    <td class="px-6 py-3 font-mono text-slate-600">{{ ev.date }}</td>
                                                    <td class="px-6 py-3">
                                                        <div class="flex items-center gap-2">
                                                            <div
                                                                class="w-5 h-5 rounded bg-slate-200 flex items-center justify-center text-[10px]">
                                                                {{ ev.worker.substring(0,1) }}</div>
                                                            {{ ev.worker }}
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-3 text-slate-700">
                                                        {{ ev.description }}
                                                        <div v-if="ev.handoffTo"
                                                            class="mt-1 text-xs text-indigo-600 font-bold">
                                                            <i class="fas fa-arrow-right mr-1"></i> ‰∫§Êé•Áµ¶Ôºö{{ ev.handoffTo
                                                            }}
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-3 text-center font-bold text-blue-600">

                                                        <div v-if="currentUser.role === 'admin'"
                                                            class="flex items-center justify-center">
                                                            <input type="number" v-model.number="ev.hours"
                                                                @change="updateEventLog" step="0.5"
                                                                class="w-16 text-center bg-transparent border-b border-dashed border-blue-300 focus:border-blue-600 outline-none text-blue-600 font-bold"
                                                                title="‰øÆÊ≠£Â∑•ÊôÇ (Admin)">
                                                            <span class="ml-1 text-xs text-blue-400">h</span>
                                                        </div>

                                                        <span v-else>{{ ev.hours }} h</span>

                                                    </td>
                                                    <td class="px-6 py-3">
                                                        <span v-if="ev.matchedMilestoneId"
                                                            class="inline-flex items-center px-2 py-0.5 rounded text-[10px] bg-emerald-100 text-emerald-700 border border-emerald-200">
                                                            <i class="fas fa-link mr-1"></i> {{
                                                            getMilestoneName(ev.matchedMilestoneId) }}
                                                        </span>
                                                        <span v-else class="text-slate-300 text-xs">-</span>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div v-if="detailTab === 'comments'"
                                    class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-96">
                                    <div class="flex-1 overflow-y-auto p-6 space-y-4 bg-slate-50">
                                        <div v-if="!currentSubProject.comments || currentSubProject.comments.length===0"
                                            class="text-center text-slate-400 text-xs italic py-10">Â∞öÁÑ°ÁïôË®ÄÔºåÈñãÂßãË®éË´ñÂêßÔºÅ</div>
                                        <div v-for="c in currentSubProject.comments" :key="c.id"
                                            :class="['flex', c.user === currentUser.name ? 'justify-end' : 'justify-start']">
                                            <div
                                                :class="['max-w-[70%] rounded-lg p-3 text-sm shadow-sm relative', c.user === currentUser.name ? 'bg-indigo-600 text-white chat-right' : 'bg-white border border-slate-200 text-slate-700 chat-left']">
                                                <div class="text-[10px] opacity-70 mb-1 flex justify-between gap-4">
                                                    <span>{{ c.user }}</span>
                                                    <span>{{ c.time }}</span>
                                                </div>
                                                {{ c.content }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="p-4 bg-white border-t border-slate-100 flex gap-2 relative">
                                        <input v-model="newComment" @keyup.enter="addComment" @input="checkForMention"
                                            type="text"
                                            class="flex-1 border rounded-lg px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500"
                                            placeholder="Ëº∏ÂÖ•ÁïôË®Ä... (@ÊèêÂèäÊàêÂì°)">
                                        <div v-if="showMentionList"
                                            class="absolute bottom-16 left-4 bg-white shadow-xl rounded-lg border w-48 z-50 max-h-48 overflow-y-auto">
                                            <div v-for="u in users" :key="u.id" @click="selectMention(u.name)"
                                                class="px-3 py-2 text-xs hover:bg-indigo-50 cursor-pointer font-bold text-slate-700 border-b last:border-0 border-slate-50">
                                                {{ u.name }} <span
                                                    class="text-[10px] text-slate-400 font-normal ml-1">({{
                                                    teamMap[u.team] }})</span>
                                            </div>
                                        </div>
                                        <button @click="addComment"
                                            class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-indigo-700">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="showMemberDetailModal"
                        class="fixed inset-0 z-[9999] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center fade-in">
                        <div class="bg-white w-[900px] h-[90vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden">
                            <div class="px-8 py-6 border-b flex justify-between items-center bg-slate-50">
                                <div>
                                    <h3 class="font-bold text-2xl text-slate-800 flex items-center">
                                        <div
                                            class="w-10 h-10 rounded-full bg-indigo-600 text-white flex items-center justify-center text-lg mr-3">
                                            {{ currentMemberDetail.name.substring(0,1) }}
                                        </div>
                                        {{ currentMemberDetail.name }}
                                        <span class="text-sm font-normal text-slate-500">Ôºà{{
                                            teamMap[currentMemberDetail.team] }}{{ roleMap[currentMemberDetail.role]
                                            }}Ôºâ</span>
                                    </h3>
                                </div>
                                <div class="flex items-center gap-3">
                                    <span class="text-xs font-bold text-slate-400">Âπ¥‰ªΩÁØ©ÈÅ∏:</span>
                                    <select v-model="memberDetailYear" @change="recalcMemberDetail"
                                        class="border border-slate-300 rounded px-2 py-1 text-sm outline-none focus:border-indigo-500">
                                        <option value="all">ÂÖ®ÈÉ®</option>
                                        <option v-for="y in availableYears" :value="y">{{ y }}Âπ¥</option>
                                    </select>
                                    <button @click="showMemberDetailModal=false"
                                        class="text-slate-400 hover:text-slate-600 ml-2 transition">
                                        <i class="fas fa-times text-xl"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="flex-1 overflow-y-auto p-8 bg-slate-50/50">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 h-full">

                                    <div class="space-y-6 flex flex-col h-full">

                                        <div
                                            class="bg-white rounded-xl border border-slate-200 overflow-hidden flex-1 flex flex-col shadow-sm">
                                            <div
                                                class="px-4 py-3 bg-red-50 border-b border-red-100 text-xs font-bold text-red-800 flex justify-between">
                                                <span>üî¥ Êâã‰∏äÂæÖËæ¶Ê∏ÖÂñÆ (Handling)</span>
                                                <span>{{ memberDetailData.active.count }} Ê°à</span>
                                            </div>
                                            <div class="flex-1 overflow-y-auto">
                                                <div v-if="memberDetailData.active.tasks.length===0"
                                                    class="p-4 text-center text-slate-400 text-xs italic">ÁõÆÂâçÁÑ°ÂæÖËæ¶</div>

                                                <div v-for="t in memberDetailData.active.tasks" :key="t.sub.id"
                                                    @click="selectSubProject(t.sub, t.parent); showMemberDetailModal=false"
                                                    class="p-3 border-b last:border-0 hover:bg-indigo-50 cursor-pointer transition flex justify-between items-center group">
                                                    <div class="truncate pr-2">
                                                        <div
                                                            class="text-[10px] text-slate-400 group-hover:text-indigo-400 flex items-center gap-1">
                                                            <span
                                                                class="bg-slate-100 text-slate-600 px-1.5 py-0.5 rounded font-bold">{{
                                                                t.brand?.name }}</span>
                                                            <i class="fas fa-chevron-right text-[8px]"></i>
                                                            {{ t.parent.title }}
                                                        </div>
                                                        <div
                                                            class="font-bold text-sm text-slate-700 truncate group-hover:text-indigo-700 transition">
                                                            {{ t.sub.title }}
                                                        </div>
                                                    </div>
                                                    <div class="text-right flex flex-col items-end flex-shrink-0">
                                                        <span
                                                            class="text-xs font-bold text-indigo-600 bg-indigo-50 px-1.5 rounded group-hover:bg-white">{{
                                                            t.holdDays }} Â§©</span>
                                                        <span class="text-[10px] text-slate-400 mt-0.5">ÊªØÁïô</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div
                                            class="bg-white rounded-xl border border-slate-200 overflow-hidden flex-1 flex flex-col shadow-sm">
                                            <div
                                                class="px-4 py-3 bg-indigo-50 border-b border-indigo-100 text-xs font-bold text-indigo-800 flex justify-between">
                                                <span>üîµ Ë≤†Ë≤¨Â∞àÊ°àÂàóË°® (Owned) <span v-if="memberDetailYear!=='all'">({{
                                                        memberDetailYear }})</span></span>
                                                <span>{{ memberDetailData.overall.total }} Ê°à</span>
                                            </div>
                                            <div class="flex-1 overflow-y-auto">
                                                <div v-if="memberDetailData.overall.projects.length===0"
                                                    class="p-4 text-center text-slate-400 text-xs italic">ÁÑ°Ë≤†Ë≤¨Â∞àÊ°à</div>

                                                <div v-for="p in memberDetailData.overall.projects" :key="p.sub.id"
                                                    @click="selectSubProject(p.sub, p.parent); showMemberDetailModal=false"
                                                    class="p-3 border-b last:border-0 hover:bg-indigo-50 cursor-pointer transition flex justify-between items-center text-xs group">

                                                    <div class="truncate pr-2">
                                                        <div
                                                            class="text-[10px] text-slate-400 mb-0.5 group-hover:text-indigo-400 flex items-center">
                                                            <span
                                                                class="bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded mr-1">{{
                                                                p.brand?.name || 'Brand' }}</span>
                                                            <i
                                                                class="fas fa-angle-right text-[8px] mx-1 opacity-50"></i>
                                                            <span>{{ p.parent.title }}</span>
                                                        </div>

                                                        <div
                                                            class="font-bold text-slate-700 group-hover:text-indigo-700 transition truncate">
                                                            {{ p.sub.title }}
                                                        </div>
                                                    </div>

                                                    <div>
                                                        <span :class="statusBadge(p.sub.status)"
                                                            class="px-1.5 py-0.5 rounded text-[10px]">
                                                            {{ statusMap[p.sub.status] }}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="space-y-6">
                                        <div>
                                            <h4 class="font-bold text-lg text-slate-700 mb-3">Âü∑Ë°åÈ¢®Èö™ÊåáÊ®ô</h4>
                                            <div class="grid grid-cols-2 gap-4">
                                                <div class="bg-white p-5 rounded-xl border border-red-100 shadow-sm">
                                                    <div class="text-xs text-slate-500 mb-1">Âπ≥ÂùáÊªØÁïô</div>
                                                    <div class="text-3xl font-bold text-red-600">{{
                                                        memberDetailData.active.avgHoldDays }} <span
                                                            class="text-sm font-normal text-slate-400">Â§©</span></div>
                                                </div>
                                                <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                                                    <div class="text-xs text-slate-500 mb-1">ÊúÄÂ§ßÊªØÁïô</div>
                                                    <div class="text-3xl font-bold text-slate-800">{{
                                                        memberDetailData.active.maxHold || 0 }} <span
                                                            class="text-sm font-normal text-slate-400">Â§©</span></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <h4 class="font-bold text-lg text-slate-700 mb-3">Ê≠∑Âè≤Á∏æÊïàÊåáÊ®ô <span
                                                    v-if="memberDetailYear!=='all'"
                                                    class="text-xs bg-slate-200 px-2 py-0.5 rounded">{{ memberDetailYear
                                                    }}</span></h4>
                                            <div class="grid grid-cols-2 gap-4">
                                                <div class="bg-white p-4 rounded-xl border border-indigo-100 shadow-sm">
                                                    <div class="text-xs text-slate-500 mb-1">Âª∂ÈÅ≤Áéá</div>
                                                    <div class="text-2xl font-bold text-indigo-600">{{
                                                        memberDetailData.overall.delayRate }}%</div>
                                                </div>
                                                <div class="bg-white p-4 rounded-xl border border-indigo-100 shadow-sm">
                                                    <div class="text-xs text-slate-500 mb-1">Á∏ΩÂª∂ÈÅ≤Â§©Êï∏</div>
                                                    <div class="text-2xl font-bold text-pink-600">{{
                                                        memberDetailData.overall.totalDelayDays }} <span
                                                            class="text-xs text-slate-400">Â§©</span></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div
                                            class="bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm">
                                            <div
                                                class="px-4 py-3 bg-slate-50 border-b text-xs font-bold text-slate-500">
                                                ‰∏ªË¶ÅÂª∂ÈÅ≤ÂéüÂõ† (Top 5)</div>
                                            <div class="p-4 space-y-3">
                                                <div v-if="memberDetailData.overall.reasons.length===0"
                                                    class="text-center text-slate-400 text-xs italic">Â∞öÁÑ°Âª∂ÈÅ≤Á¥ÄÈåÑ</div>
                                                <div v-for="r in memberDetailData.overall.reasons.slice(0,5)"
                                                    :key="r.name" class="flex items-center text-sm">
                                                    <span class="w-24 font-bold text-slate-600 truncate"
                                                        :title="r.name">{{ r.name }}</span>
                                                    <div class="flex-1 h-2 bg-slate-100 rounded-full mx-3">
                                                        <div class="h-2 bg-indigo-500 rounded-full"
                                                            :style="{width: r.percent+'%'}"></div>
                                                    </div>
                                                    <span class="font-bold text-indigo-600">{{ r.count }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div v-if="showEditBranchModal"
                        class="fixed inset-0 z-[9999] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center fade-in">
                        <div class="bg-white w-[500px] rounded-2xl shadow-2xl p-8 flex flex-col max-h-[90vh]">
                            <h3 class="font-bold text-xl text-slate-800 mb-6">Á∑®ËºØÂ≠êÂ∞àÊ°àË®≠ÂÆö</h3>
                            <div class="space-y-4 flex-1 overflow-y-auto">
                                <div><label class="text-xs font-bold text-slate-500 block mb-1">Â∞àÊ°àÂêçÁ®±</label><input
                                        v-model="editBranchForm.title" class="w-full border rounded-lg px-3 py-2"></div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-xs font-bold text-slate-500 block mb-1">ÈñãÂßãÊó• (‰∏çÂèØËÆäÊõ¥)</label>
                                        <input type="date" v-model="editBranchForm.startDate"
                                            class="w-full border rounded-lg px-3 py-2"
                                            :class="currentUser.role !== 'admin' ? 'bg-slate-100 text-slate-500 cursor-not-allowed' : ''"
                                            :disabled="currentUser.role !== 'admin'">
                                    </div>
                                    <div>
                                        <label class="text-xs font-bold text-slate-500 block mb-1">ÁµêÊùüÊó• (Áî±ÈáåÁ®ãÁ¢ëÊ±∫ÂÆö)</label>
                                        <input type="date" v-model="editBranchForm.endDate"
                                            class="w-full border rounded-lg px-3 py-2"
                                            :class="currentUser.role !== 'admin' ? 'bg-slate-100 text-slate-500 cursor-not-allowed' : ''"
                                            :disabled="currentUser.role !== 'admin'">
                                    </div>
                                </div>
                                <div><label class="text-xs font-bold text-slate-500 block mb-1">ÁõÆÂâçË≤†Ë≤¨‰∫∫
                                        (Assignee)</label><select v-model="editBranchForm.assignee"
                                        class="w-full border rounded-lg px-3 py-2">
                                        <option v-for="u in users" :value="u.name">{{ u.name }}</option>
                                    </select></div>
                                <div class="border-t pt-4 mt-4 bg-orange-50 p-3 rounded border-orange-100">
                                    <label class="text-xs font-bold text-orange-700 block mb-1">Âª∂ÈÅ≤ÂéüÂõ†Ê®ôË®ò (Âü∑Ë°å‰∏≠ÂèØÂ°´)</label>
                                    <select v-model="editBranchForm.delayReason"
                                        class="w-full border border-orange-200 rounded-lg px-3 py-2 text-sm bg-white">
                                        <option value="">-- ÁÑ° --</option>
                                        <option value="ÈúÄÊ±ÇËÆäÊõ¥">ÈúÄÊ±ÇËÆäÊõ¥</option>
                                        <option value="ÈúÄÊ±Ç‰∏çÁ¢∫ÂÆö">ÈúÄÊ±Ç‰∏çÁ¢∫ÂÆö</option>
                                        <option value="Ê∫ùÈÄöÊàêÊú¨È´ò">Ê∫ùÈÄöÊàêÊú¨È´ò</option>
                                        <option value="‰∫∫Âäõ‰∏çË∂≥">‰∫∫Âäõ‰∏çË∂≥</option>
                                        <option value="‰Ωé‰º∞Â∑•‰ΩúÈáè">‰Ωé‰º∞Â∑•‰ΩúÈáè</option>
                                        <option value="Â§öÊñπÂÖ±Ë≠òÊú™ÂÆö">Â§öÊñπÂÖ±Ë≠òÊú™ÂÆö</option>
                                        <option value="Âª†ÂïÜÂõ†Á¥†">Âª†ÂïÜÂõ†Á¥†</option>
                                        <option value="Â§ñÈÉ®ÂñÆ‰Ωç‰∏ªÁÆ°Á¢∫Ë™çÂª∂ÈÅ≤">Â§ñÈÉ®ÂñÆ‰Ωç‰∏ªÁÆ°Á¢∫Ë™çÂª∂ÈÅ≤</option>
                                        <option value="ÂÖ∂‰ªñ">ÂÖ∂‰ªñ</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3 pt-6 border-t mt-4"><button
                                    @click="showEditBranchModal=false" class="px-4 text-slate-500">ÂèñÊ∂à</button><button
                                    @click="saveEditedBranch" :disabled="isSubmitting"
                                    class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold disabled:opacity-50">ÂÑ≤Â≠òËÆäÊõ¥</button>
                            </div>
                        </div>
                    </div>

                    <div v-if="showProjectModal"
                        class="fixed inset-0 z-[9999] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center fade-in">
                        <div class="bg-white w-[500px] rounded-2xl shadow-2xl flex flex-col p-8 space-y-5">
                            <h3 class="font-bold text-xl text-slate-800">ÈñãÁ´ãÂ∞àÊ°à (Parent)</h3>
                            <div class="space-y-4">
                                <div><label class="block text-xs font-bold text-slate-500 mb-1">Â∞àÊ°àÂêçÁ®±</label><input
                                        v-model="projectForm.title" class="w-full border rounded-lg px-4 py-2"></div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label class="block text-xs font-bold text-slate-500 mb-1">ÈñãÊ°àÊó•</label><input
                                            type="date" v-model="projectForm.startDate"
                                            class="w-full border rounded-lg px-4 py-2"></div>
                                    <div><label class="block text-xs font-bold text-slate-500 mb-1">È†êË®àÁµêÊùü</label><input
                                            type="date" v-model="projectForm.endDate"
                                            class="w-full border rounded-lg px-4 py-2"></div>
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3 pt-4"><button @click="showProjectModal=false"
                                    class="px-4 text-slate-500">ÂèñÊ∂à</button><button @click="saveProject"
                                    :disabled="isSubmitting"
                                    class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold shadow-lg disabled:opacity-50">Âª∫Á´ã</button>
                            </div>
                        </div>
                    </div>

                    <div v-if="showSubProjectModal"
                        class="fixed inset-0 z-[9999] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center fade-in">
                        <div class="bg-white w-[500px] rounded-2xl shadow-2xl p-8 space-y-5">
                            <h3 class="font-bold text-xl text-slate-800">ÈñãÁ´ãÂ≠êÂ∞àÊ°à</h3><input v-model="subProjectForm.title"
                                class="w-full border rounded-lg px-4 py-2" placeholder="Â≠êÂ∞àÊ°àÂêçÁ®±"><select
                                v-model="subProjectForm.assignee" class="w-full border rounded-lg px-4 py-2 bg-white">
                                <option v-for="u in users" :value="u.name">{{ u.name }} ({{ teamMap[u.team] }})</option>
                            </select>
                            <div class="flex justify-end space-x-3 pt-4"><button @click="showSubProjectModal=false"
                                    class="px-4 text-slate-500">ÂèñÊ∂à</button><button @click="saveSubProject"
                                    :disabled="isSubmitting"
                                    class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold shadow-lg disabled:opacity-50">ÈñãÁ´ã</button>
                            </div>
                        </div>
                    </div>

                    <div v-if="showEventModal"
                        class="fixed inset-0 z-[9999] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center fade-in">
                        <div class="bg-white w-[500px] rounded-2xl shadow-2xl p-8 space-y-5">
                            <h3 class="font-bold text-xl text-slate-800">Êñ∞Â¢ûÂ∑•‰ΩúÊó•Ë™å</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div><label class="block text-xs font-bold text-slate-500 mb-1">Êó•Êúü</label><input
                                        type="date" v-model="eventForm.date" class="w-full border rounded-lg px-3 py-2">
                                </div>
                                <div><label class="block text-xs font-bold text-slate-500 mb-1">Â∑•ÊôÇ (Hr)</label><input
                                        type="number" v-model="eventForm.hours"
                                        class="w-full border rounded-lg px-3 py-2"></div>
                            </div>
                            <div><label class="block text-xs font-bold text-slate-500 mb-1">Âü∑Ë°å‰∫∫Âì°</label>
                                <div
                                    class="w-full bg-slate-100 border rounded-lg px-3 py-2 text-slate-600 cursor-not-allowed">
                                    {{ eventForm.worker }}</div>
                            </div>
                            <div><label class="block text-xs font-bold text-slate-500 mb-1">Â∑•‰ΩúÂÖßÂÆπ</label><textarea
                                    v-model="eventForm.description" class="w-full border rounded-lg px-3 py-2 h-20"
                                    placeholder="ÂÅö‰∫Ü‰ªÄÈ∫º..."></textarea></div>
                            <div v-if="incompleteMilestones.length > 0" class="border-t pt-4"><label
                                    class="block text-xs font-bold text-indigo-600 mb-2">ÂåπÈÖçÁØÄÈªû (ÈÅ∏Â°´)</label><select
                                    v-model="eventForm.matchedMilestoneId"
                                    class="w-full border border-indigo-200 bg-indigo-50 rounded-lg px-3 py-2 text-sm text-indigo-800">
                                    <option value="">-- ÁÑ°ÂåπÈÖçÁØÄÈªû --</option>
                                    <option v-for="ms in incompleteMilestones" :value="ms.id">{{ ms.title }} (È†êÂÆö: {{
                                        ms.date }})</option>
                                </select></div>
                            <div class="border-t pt-4 bg-orange-50 p-3 rounded-lg border-orange-100"><label
                                    class="block text-xs font-bold text-orange-700 mb-1"><i
                                        class="fas fa-share mr-1"></i> ÂæåÁ∫åËôïÁêÜ‰∫∫Âì° (ÁêÉÊ¨äÁßªËΩâ)</label><select
                                    v-model="eventForm.nextAssignee"
                                    class="w-full border border-orange-200 rounded-lg px-3 py-2 text-sm bg-white">
                                    <option v-for="u in users" :value="u.name">{{ u.name }} {{ u.name ===
                                        currentUser.name ? '(ÊàëËá™Â∑±)' : '' }}</option>
                                </select></div>
                            <div class="flex justify-end space-x-3 pt-4"><button @click="showEventModal=false"
                                    class="px-4 text-slate-500">ÂèñÊ∂à</button><button @click="saveEvent"
                                    :disabled="isSubmitting"
                                    class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold shadow-lg disabled:opacity-50">ÂÑ≤Â≠ò‰∏¶Êõ¥Êñ∞</button>
                            </div>
                        </div>
                    </div>

                    <div v-if="showDelayReasonModal"
                        class="fixed inset-0 z-[9999] bg-red-900/50 backdrop-blur-sm flex items-center justify-center fade-in">
                        <div class="bg-white w-[400px] rounded-2xl shadow-2xl p-8 space-y-5 border-t-4"
                            :class="modalMode.includes('abort')?'border-red-600':'border-orange-500'">
                            <h3 class="font-bold text-xl"
                                :class="modalMode.includes('abort')?'text-red-600':'text-orange-600'">{{ modalTitle }}
                            </h3>
                            <p class="text-sm text-slate-600">Ë´ãÂ°´ÂØ´ÂéüÂõ†ËàáÂÇôË®ª‰ª•ÂÆåÊàêÊìç‰Ωú„ÄÇ</p>
                            <select v-model="delayForm.reason" class="w-full border rounded-lg px-3 py-2">
                                <option value="Â§ñÈÉ®ÂñÆ‰ΩçÂèñÊ∂àÈúÄÊ±ÇÔºà‰∏≠Ê≠¢Áî®Ôºâ">Â§ñÈÉ®ÂñÆ‰ΩçÂèñÊ∂àÈúÄÊ±ÇÔºà‰∏≠Ê≠¢Áî®Ôºâ</option>
                                <option value="Â∞àÊ°àÂÅöÊ≥ïËÆäÊõ¥Ôºà‰∏≠Ê≠¢Áî®Ôºâ">Â∞àÊ°àÂÅöÊ≥ïËÆäÊõ¥Ôºà‰∏≠Ê≠¢Áî®Ôºâ</option>
                                <option value="ÈúÄÊ±ÇËÆäÊõ¥">ÈúÄÊ±ÇËÆäÊõ¥</option>
                                <option value="ÈúÄÊ±Ç‰∏çÁ¢∫ÂÆö">ÈúÄÊ±Ç‰∏çÁ¢∫ÂÆö</option>
                                <option value="Ê∫ùÈÄöÊàêÊú¨È´ò">Ê∫ùÈÄöÊàêÊú¨È´ò</option>
                                <option value="‰∫∫Âäõ‰∏çË∂≥">‰∫∫Âäõ‰∏çË∂≥</option>
                                <option value="‰Ωé‰º∞Â∑•‰ΩúÈáè">‰Ωé‰º∞Â∑•‰ΩúÈáè</option>
                                <option value="Â§öÊñπÂÖ±Ë≠òÊú™ÂÆö">Â§öÊñπÂÖ±Ë≠òÊú™ÂÆö</option>
                                <option value="Âª†ÂïÜÂõ†Á¥†">Âª†ÂïÜÂõ†Á¥†</option>
                                <option value="Â§ñÈÉ®ÂñÆ‰Ωç‰∏ªÁÆ°Á¢∫Ë™çÂª∂ÈÅ≤">Â§ñÈÉ®ÂñÆ‰Ωç‰∏ªÁÆ°Á¢∫Ë™çÂª∂ÈÅ≤</option>
                                <option value="ÂÖ∂‰ªñ">ÂÖ∂‰ªñ</option>
                            </select>
                            <textarea v-model="delayForm.remark" class="w-full border rounded-lg px-3 py-2 h-20"
                                placeholder="ÂÇôË®ªË™™Êòé..."></textarea>
                            <div class="flex justify-end space-x-3 pt-4"><button @click="showDelayReasonModal=false"
                                    class="px-4 text-slate-500">ÂèñÊ∂à</button><button @click="submitDelayModal"
                                    :disabled="isSubmitting"
                                    :class="modalMode.includes('abort')?'bg-red-600':'bg-orange-500'"
                                    class="text-white px-6 py-2 rounded-lg font-bold disabled:opacity-50">Á¢∫Ë™ç</button>
                            </div>
                        </div>
                    </div>

                    <div v-if="showQuickViewModal"
                        class="fixed inset-0 z-[9999] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center fade-in"
                        @click.self="showQuickViewModal=false">
                        <div
                            class="bg-white w-[450px] max-h-[90vh] rounded-2xl shadow-2xl overflow-hidden flex flex-col relative">
                            <div
                                class="px-6 py-4 border-b border-slate-100 bg-slate-50 flex justify-between items-start">
                                <div>
                                    <div class="text-xs font-bold text-slate-400 mb-1 flex items-center gap-2">
                                        <span class="bg-slate-800 text-white px-2 py-0.5 rounded">{{
                                            quickViewData.brand?.name || 'Brand' }}</span>
                                        <i class="fas fa-chevron-right text-[8px]"></i>
                                        <span class="bg-indigo-100 text-indigo-600 px-2 py-0.5 rounded">{{
                                            quickViewData.parent.title }}</span>
                                    </div>
                                    <h3 class="text-lg font-bold text-slate-800 leading-tight">{{
                                        quickViewData.branch.title }}</h3>
                                </div>
                                <button @click="showQuickViewModal=false"
                                    class="text-slate-400 hover:text-slate-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-200 transition">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>

                            <div class="flex-1 overflow-y-auto p-0">
                                <div class="p-6 bg-white border-b border-slate-100">
                                    <h4 class="text-xs font-bold text-slate-400 uppercase mb-3 tracking-wider">ÁõÆÂâçËôïÁêÜÊÉÖÂΩ¢
                                    </h4>

                                    <div class="grid grid-cols-2 gap-4 mb-4">
                                        <div class="bg-slate-50 p-3 rounded-lg border border-slate-100">
                                            <div class="text-[10px] text-slate-500 mb-1">ÁõÆÂâçÁêÉÊ¨ä (Handler)</div>
                                            <div class="font-bold text-slate-800 flex items-center">
                                                <div
                                                    class="w-6 h-6 rounded bg-indigo-600 text-white flex items-center justify-center text-xs mr-2">
                                                    {{ quickViewData.branch.currentHandler.substring(0,1) }}
                                                </div>
                                                {{ quickViewData.branch.currentHandler }}
                                            </div>
                                        </div>
                                        <div class="p-3 rounded-lg border"
                                            :class="getDaysHeld(quickViewData.branch) > 3 ? 'bg-red-50 border-red-100' : 'bg-emerald-50 border-emerald-100'">
                                            <div class="text-[10px] mb-1"
                                                :class="getDaysHeld(quickViewData.branch) > 3 ? 'text-red-500' : 'text-emerald-500'">
                                                Â∑≤ÊªØÁïô (Days Held)</div>
                                            <div class="font-bold text-xl"
                                                :class="getDaysHeld(quickViewData.branch) > 3 ? 'text-red-600' : 'text-emerald-600'">
                                                {{ getDaysHeld(quickViewData.branch) }} <span
                                                    class="text-xs font-normal text-slate-400">Â§©</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div
                                        class="flex items-center justify-between bg-slate-50 px-3 py-2 rounded text-xs">
                                        <span class="font-bold text-slate-500">Êà™Ê≠¢ÁãÄÊ≥Å</span>
                                        <span v-if="getProjectHealth(quickViewData.branch).type === 'delay'"
                                            class="text-red-600 font-bold bg-white px-2 py-0.5 rounded shadow-sm border border-red-100">
                                            üî¥ Âª∂Ë™§ {{ getProjectHealth(quickViewData.branch).days }} Â§©
                                        </span>
                                        <span v-else-if="getProjectHealth(quickViewData.branch).type === 'lag'"
                                            class="text-orange-500 font-bold bg-white px-2 py-0.5 rounded shadow-sm border border-orange-100">
                                            üü† ÈÄ≤Â∫¶ËêΩÂæå {{ getProjectHealth(quickViewData.branch).days }} Â§©
                                        </span>
                                        <span v-else
                                            class="text-emerald-600 font-bold bg-white px-2 py-0.5 rounded shadow-sm border border-emerald-100">
                                            üü¢ ÈÄ≤Â∫¶Ê≠£Â∏∏
                                        </span>
                                    </div>
                                </div>

                                <div class="p-6">
                                    <h4 class="text-xs font-bold text-slate-400 uppercase mb-4 tracking-wider">Â∞àÊ°àÁØÄÈªû
                                        (Milestones)</h4>

                                    <div class="relative pl-2">
                                        <div class="absolute left-[19px] top-2 bottom-4 w-0.5 bg-slate-200"></div>

                                        <div v-if="!quickViewData.branch.milestones || quickViewData.branch.milestones.length===0"
                                            class="text-center text-slate-400 text-sm py-4 italic">
                                            Â∞öÊú™Ë®≠ÂÆöÁØÄÈªû
                                        </div>

                                        <div v-for="(ms, idx) in getQuickViewMilestones(quickViewData.branch)"
                                            :key="idx" class="relative pl-10 mb-6 last:mb-0 group">

                                            <div class="absolute left-0 top-0 w-10 h-10 rounded-full border-4 flex items-center justify-center bg-white z-10 transition-all"
                                                :class="[
                                ms.isPast ? 'border-emerald-500 text-emerald-500' : (ms.isCurrent ? 'border-indigo-500 text-indigo-600 ring-4 ring-indigo-50' : 'border-slate-200 text-slate-300')
                            ]">
                                                <i v-if="ms.isPast" class="fas fa-check font-bold"></i>
                                                <i v-else-if="ms.isCurrent"
                                                    class="fas fa-map-marker-alt animate-bounce"></i>
                                                <div v-else class="w-2 h-2 rounded-full bg-slate-300"></div>
                                            </div>

                                            <div class="rounded-lg p-3 border transition-all" :class="[
                                ms.isCurrent ? 'bg-indigo-50 border-indigo-200 shadow-sm transform scale-105 origin-left' : 'bg-white border-slate-100 grayscale opacity-70'
                             ]">
                                                <div class="flex justify-between items-start">
                                                    <div class="font-bold text-sm"
                                                        :class="ms.isCurrent ? 'text-indigo-800' : 'text-slate-600'">{{
                                                        ms.title }}</div>
                                                    <div class="text-[10px] font-mono px-1.5 py-0.5 rounded"
                                                        :class="ms.isCurrent ? 'bg-white text-indigo-600 font-bold' : 'bg-slate-100 text-slate-400'">
                                                        {{ ms.date }}
                                                    </div>
                                                </div>
                                                <div v-if="ms.isCurrent"
                                                    class="mt-2 text-[10px] text-indigo-500 font-bold flex items-center">
                                                    <i class="fas fa-spinner fa-spin mr-1"></i> Current Target
                                                </div>
                                                <div v-if="ms.isPast"
                                                    class="mt-1 text-[10px] text-emerald-600 font-bold flex justify-between items-center">
                                                    <span>ÂÆåÊàêÊñº: {{ ms.completedDate || 'Checked' }}</span>

                                                    <span class="bg-emerald-100 text-emerald-700 px-1.5 rounded">
                                                        <i class="fas fa-stopwatch mr-1"></i>
                                                        {{ getMilestoneHours(quickViewData.branch, ms.id) }} h
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="p-4 bg-slate-50 border-t border-slate-100 flex gap-3 z-20">
                                <button @click="showQuickViewModal=false"
                                    class="flex-1 bg-white border border-slate-300 text-slate-600 py-2.5 rounded-lg font-bold text-sm hover:bg-slate-50 transition">
                                    ÈóúÈñâ
                                </button>
                                <button
                                    @click="selectSubProject(quickViewData.branch, quickViewData.parent); showQuickViewModal=false"
                                    class="flex-1 bg-indigo-600 text-white py-2.5 rounded-lg font-bold text-sm hover:bg-indigo-700 shadow-lg hover:shadow-indigo-500/30 transition flex items-center justify-center">
                                    <span>ÈÄ≤ÂÖ•Ë©≥ÊÉÖ</span> <i class="fas fa-arrow-right ml-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>
        </template>
    </div>
    <script type="module" src="/mkt-dashboard/js/app.js"></script>
</body>

</html>